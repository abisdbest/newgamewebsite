(function(l,m){typeof exports=="object"&&typeof module<"u"?module.exports=m():typeof define=="function"&&define.amd?define(m):(l=typeof globalThis<"u"?globalThis:l||self,l.Playsaurus=m())})(this,function(){"use strict";var Fe=Object.defineProperty;var Le=(l,m,I)=>m in l?Fe(l,m,{enumerable:!0,configurable:!0,writable:!0,value:I}):l[m]=I;var s=(l,m,I)=>Le(l,typeof m!="symbol"?m+"":m,I);for(var l=[],m=0;m<256;++m)l.push((m+256).toString(16).slice(1));function I(n,e=0){return(l[n[e+0]]+l[n[e+1]]+l[n[e+2]]+l[n[e+3]]+"-"+l[n[e+4]]+l[n[e+5]]+"-"+l[n[e+6]]+l[n[e+7]]+"-"+l[n[e+8]]+l[n[e+9]]+"-"+l[n[e+10]]+l[n[e+11]]+l[n[e+12]]+l[n[e+13]]+l[n[e+14]]+l[n[e+15]]).toLowerCase()}var M,de=new Uint8Array(16);function he(){if(!M&&(M=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!M))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return M(de)}var me=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const J={randomUUID:me};function W(n,e,t){if(J.randomUUID&&!e&&!n)return J.randomUUID();n=n||{};var i=n.random||(n.rng||he)();return i[6]=i[6]&15|64,i[8]=i[8]&63|128,I(i)}class z{constructor(e,t,i,a,o){s(this,"id");s(this,"session");s(this,"name");s(this,"timestamp");s(this,"properties");s(this,"sendCount",0);this.id=o??W(),this.session=e,this.name=t,this.timestamp=i,this.properties=a??{}}toJSON(){return{id:this.id,name:this.name,t:this.timestamp.toISOString(),properties:Object.keys(this.properties).length>0?this.properties:void 0}}toStorage(){return this.toJSON()}static fromStorage(e,t){const i=t.name,a=new Date(t.t),o=t.properties,u=t.id;return new z(e,i,a,o,u)}}class ge{constructor(e){s(this,"session");s(this,"status","pending");s(this,"shouldRetry",!1);if(this.events=e,e.length===0)throw new Error("The events list cannot be empty.");this.events=e,this.session=e[0].session;for(const t of e)if(t.session!==this.session)throw new Error("All events must belong to the same session.")}markAsFailAndRetry(){this.status="failed",this.shouldRetry=!0}markAsFailAndSkip(){this.status="failed",this.shouldRetry=!1}markAsSent(){this.status="sent",this.shouldRetry=!1}}class E{constructor(){s(this,"id",null);s(this,"pendingEvents",[]);s(this,"nextHeartbeatAt",null);s(this,"userAtomicId",null);s(this,"userId",null);s(this,"userUid",null);s(this,"gameVersion",null);s(this,"analyticsSdkVersion",null);s(this,"osName",null);s(this,"osVersion",null);s(this,"deviceModel",null);s(this,"deviceType",null);s(this,"deviceManufacturer",null);s(this,"deviceLocale",null);s(this,"gameLocale",null);s(this,"deviceTimezone",null);s(this,"deviceRamMb",null);s(this,"deviceCpuCores",null);s(this,"deviceCpuMhz",null);s(this,"deviceVramMb",null);s(this,"gameGraphicsApi",null);s(this,"screenWidth",null);s(this,"screenHeight",null);s(this,"screenDpi",null);s(this,"screenCount",null);s(this,"connectionType",null);s(this,"gamePlatform",null);s(this,"gameStorefront",null);s(this,"deviceGaid",null);s(this,"deviceIdfa",null);s(this,"steamId",null)}get isSubmitted(){return this.id!==null}pushEvent(e,t){const i=new z(this,e,new Date,t);return this.pendingEvents.push(i),i}dequeueEvents(e){return this.pendingEvents.splice(0,e)}returnFailedEventsToQueue(e){this.pendingEvents.push(...e)}createBatches(e){const t=[];let i=this.dequeueEvents(e);for(;i.length>0;)t.push(new ge(i)),i=this.dequeueEvents(e);return t}toJSON(){return E._removeNulls({user_atomic_id:this.userAtomicId,user_id:this.userId,user_uid:this.userUid,game_version:this.gameVersion,analytics_sdk_version:this.analyticsSdkVersion,os_name:this.osName,os_version:this.osVersion,device_model:this.deviceModel,device_type:this.deviceType,device_manufacturer:this.deviceManufacturer,device_locale:this.deviceLocale,game_locale:this.gameLocale,device_timezone:this.deviceTimezone,device_ram_mb:this.deviceRamMb,device_cpu_cores:this.deviceCpuCores,device_cpu_mhz:this.deviceCpuMhz,device_vram_mb:this.deviceVramMb,game_graphics_api:this.gameGraphicsApi,screen_width:this.screenWidth,screen_height:this.screenHeight,screen_dpi:this.screenDpi,screen_count:this.screenCount,connection_type:this.connectionType,game_platform:this.gamePlatform,game_storefront:this.gameStorefront,device_gaid:this.deviceGaid,device_idfa:this.deviceIdfa,steam_id:this.steamId})}static _removeNulls(e){return Object.keys(e).forEach(t=>{(e[t]===null||e[t]===void 0)&&delete e[t]}),e}toStorage(){return{id:this.id,...this.toJSON(),pending_events:this.pendingEvents.map(e=>e.toStorage())}}static fromStorage(e){const t=Object.assign(new E,E._removeNulls({id:e.id,userAtomicId:e.user_atomic_id,userId:e.user_id,userUid:e.user_uid,gameVersion:e.game_version,analyticsSdkVersion:e.analytics_sdk_version,osName:e.os_name,osVersion:e.os_version,deviceModel:e.device_model,deviceType:e.device_type,deviceManufacturer:e.device_manufacturer,deviceLocale:e.device_locale,deviceTimezone:e.device_timezone,gameLocale:e.game_locale,deviceRamMb:e.device_ram_mb,deviceCpuCores:e.device_cpu_cores,deviceCpuMhz:e.device_cpu_mhz,deviceVramMb:e.device_vram_mb,gameGraphicsApi:e.game_graphics_api,screenWidth:e.screen_width,screenHeight:e.screen_height,screenDpi:e.screen_dpi,screenCount:e.screen_count,userAgent:e.user_agent,connectionType:e.connection_type,gamePlatform:e.game_platform,gameStorefront:e.game_storefront,deviceGaid:e.device_gaid,deviceIdfa:e.device_idfa,steamId:e.steam_id}));return e.pending_events&&(t.pendingEvents=e.pending_events.map(i=>z.fromStorage(t,i))),t}}var f=(n=>(n.Offline="offline",n.Online="online",n.Wifi="wifi",n.Ethernet="ethernet",n.Mobile="mobile",n))(f||{}),O=(n=>(n.Windows="windows",n.Linux="linux",n.MacOS="macos",n.Android="android",n.IOS="ios",n))(O||{});class _e{static getConnectionType(){const e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;if(!e)return f.Online;const t={bluetooth:f.Mobile,cellular:f.Mobile,ethernet:f.Ethernet,none:f.Offline,wifi:f.Wifi,wimax:f.Mobile,unknown:null}[e.type];return t||(e.saveData===!0?f.Mobile:f.Online)}}const N=class N{constructor(){s(this,"_atomicId",null)}static get instance(){return this._instance??(this._instance=new N),this._instance}getId(){return this._atomicId?this._atomicId:(this._atomicId=localStorage.getItem("playsaurus-atomic-id"),this._atomicId?this._atomicId:(this._atomicId=W(),localStorage.setItem("playsaurus-atomic-id",this._atomicId),this._atomicId))}};s(N,"_instance",null);let x=N;class U{constructor(){s(this,"_initialized",!1)}async collect(e,t){return this._initialized||(await this.initialize(),this._initialized=!0),this.fillContextInfo(e,t),e.userAtomicId=await this.getAtomicId(),e.connectionType=this.getConnectionType(),e.osName=this.getOsName(),e.osVersion=this.getOsVersion(),e.deviceModel=this.getDeviceModel(),e.deviceType=this.getDeviceType(),e.deviceManufacturer=this.getDeviceManufacturer(),e.deviceLocale=this.getDeviceLocale(),e.deviceTimezone=this.getDeviceTimezone(),e.deviceRamMb=this.getDeviceRamMb(),e.deviceCpuCores=this.getDeviceCpuCores(),e.deviceCpuMhz=this.getDeviceCpuMhz(),e.deviceVramMb=this.getDeviceVramMb(),e.gameGraphicsApi=this.getGameGraphicsApi(),e.screenWidth=this.getScreenWidth(),e.screenHeight=this.getScreenHeight(),e.screenDpi=this.getScreenDpi(),e.screenCount=this.getScreenCount(),Promise.resolve()}async initialize(){return Promise.resolve()}fillContextInfo(e,t){e.gameVersion=t.gameVersion,e.analyticsSdkVersion=t.analyticsSdkVersion,e.gameLocale=t.gameLocale,e.gamePlatform=t.gamePlatform,e.gameStorefront=t.gameStorefront,e.userUid=t.userUid,e.steamId=t.steamId,e.deviceIdfa=t.deviceIdfa,e.deviceGaid=t.deviceGaid}async getAtomicId(){return x.instance.getId()}getOsName(){return null}getOsVersion(){return null}getDeviceModel(){return null}getDeviceManufacturer(){return null}getDeviceType(){return null}getDeviceLocale(){return navigator.language}getDeviceTimezone(){return Intl.DateTimeFormat().resolvedOptions().timeZone}getDeviceCpuMhz(){return null}getGameGraphicsApi(){return null}getDeviceRamMb(){return typeof navigator.deviceMemory<"u"?navigator.deviceMemory*1024:null}getScreenWidth(){return window.devicePixelRatio?Math.floor(window.screen.width*window.devicePixelRatio):window.screen.width}getScreenHeight(){return window.devicePixelRatio?Math.floor(window.screen.height*window.devicePixelRatio):window.screen.height}getScreenDpi(){return window.devicePixelRatio?Math.round(window.devicePixelRatio*96):null}getConnectionType(){return _e.getConnectionType()}getDeviceCpuCores(){return typeof navigator.hardwareConcurrency<"u"?navigator.hardwareConcurrency:null}getDeviceVramMb(){return null}getScreenCount(){return window.screen&&typeof window.screen.isExtended<"u"?window.screen.isExtended?2:1:null}}class fe{constructor(e){s(this,"event");this.event=e}get session(){return this.event.session}get queueLength(){return this.session.pendingEvents.length}}class pe{async get(e){return localStorage.getItem(e)}async set(e,t){localStorage.setItem(e,t)}async remove(e){localStorage.removeItem(e)}}class we{constructor(e){s(this,"_pendingSessions",new Set);s(this,"_storage");this._storage=e}add(e){this._pendingSessions.add(e)}addRange(e){for(const t of e)this.add(t)}remove(e){this._pendingSessions.delete(e)}async save(){const e={v:1,sessions:[...this._pendingSessions].map(t=>t.toStorage())};await this._storage.set("playsaurus-analytics-sessions",JSON.stringify(e))}async restore(){const e=await this._storage.get("playsaurus-analytics-sessions");if(!e)return[];const t=JSON.parse(e);if(t.v!==1)return[];const i=t.sessions.map(a=>E.fromStorage(a));for(const a of i)this.add(a);return i}getAll(){return[...this._pendingSessions]}dequeueAll(){const e=this.getAll();return this._pendingSessions.clear(),e}}class ve{constructor(e,t){s(this,"_timeoutId",null);s(this,"_failedAttempts",0);s(this,"_nextFlushAt",null);s(this,"_nextHeartbeatAt",null);s(this,"dateProvider",()=>new Date);s(this,"onFlush");s(this,"debounceTime",15);s(this,"_currentBackoffTime",-1);this.onFlush=e,this.debounceTime=t||this.debounceTime}get failedAttempts(){return this._failedAttempts}get nextFlushAt(){return this._nextFlushAt}get nextHeartbeatAt(){return this._nextHeartbeatAt}get retryTime(){return this._currentBackoffTime}_scheduleNextFlushIn(e){this._timeoutId&&window.clearTimeout(this._timeoutId),e*=1e3,this._nextFlushAt=new Date(Date.now()+e),this._timeoutId=window.setTimeout(this.onFlush,e)}clear(){this._timeoutId&&(window.clearTimeout(this._timeoutId),this._timeoutId=null)}_getExponentialBackoff(e){return Math.min(Math.pow(2,e-1)*this.debounceTime,3600)}scheduleRetry(){this._currentBackoffTime=this._getExponentialBackoff(++this._failedAttempts),this._scheduleNextFlushIn(this._currentBackoffTime)}scheduleNextFlush(){this._failedAttempts=0,this._currentBackoffTime=-1,this._scheduleNextFlushIn(this.debounceTime)}scheduleHeartbeatAt(e){if(!e){this._nextHeartbeatAt=null;return}if(this._nextFlushAt&&e<this._nextFlushAt)return;const t=e.getTime()-this.dateProvider().getTime();this._nextHeartbeatAt=e,this._scheduleNextFlushIn(t/1e3)}get isHeartbeatTime(){if(this._nextHeartbeatAt===null)return!1;const e=10*1e3,t=this.dateProvider().getTime(),i=this._nextHeartbeatAt.getTime();return t>=i-e&&t<=i+e}}class F{constructor(){s(this,"_start");this._start=new Date().getTime()}static start(){return new F}get elapsed(){return new Date().getTime()-this._start}}class S extends Error{constructor(t,i,a){super(t??`Request failed with status code ${(i==null?void 0:i.status)??0}`);s(this,"response");s(this,"shouldRetry");s(this,"duration");this.response=i??null,this.shouldRetry=this._shouldRetry(i),this.duration=a??0}static fromResponse(t,i){return new S(void 0,t,i)}static deviceOffline(){return new S("Device is offline")}_shouldRetry(t){if(!t)return!1;const i=Math.floor(((t==null?void 0:t.status)??0)/100);return i===5||i===0||t.status===429}}class ye{constructor(e){s(this,"baseUrl","");s(this,"supportsBeaconAPI",navigator.sendBeacon!==void 0);this.baseUrl=e}async send(e,t){const i=this._getEventPayload(t,e),a=F.start(),o=await fetch(`${this.baseUrl}/events`,{method:"POST",headers:r.getDefaultHeaders(),body:JSON.stringify(i),keepalive:!0}),u=a.elapsed;if(!o.ok)throw S.fromResponse(o,u);const w=await o.json();return{response:o,duration:u,data:w}}sendHeartbeat(e){return this.send(e,[])}sendWithBeaconAPI(e,t){if(!this.supportsBeaconAPI)return!1;const i=this._getEventPayload(t,e),a=new Blob([JSON.stringify(i)],{type:"application/json"});return navigator.sendBeacon(`${this.baseUrl}/events`,a)}_getEventPayload(e,t){const i=t.id===null;return{ts:new Date().toISOString(),events:e.map(a=>a.toJSON()),session:i?t.toJSON():void 0,session_id:i?void 0:t.id}}}class Se{constructor(e,t,i){s(this,"events");s(this,"response",null);s(this,"duration",-1);s(this,"innerError",null);this.events=e,this.response=t instanceof S?t.response:null,this.innerError=t??null,this.duration=i??-1}get session(){return this.events[0].session}}class j{constructor(e){s(this,"events");this.events=e}get session(){return this.events[0].session}}class be{constructor(e,t,i){s(this,"events");s(this,"response",null);s(this,"duration",0);this.events=e,this.response=t??null,this.duration=i??-1}get session(){return this.events[0].session}}class Te{constructor(e,t){s(this,"onEventsSending",()=>{});s(this,"onEventsSent",()=>{});s(this,"onEventsFailed",()=>{});s(this,"_broker");s(this,"maxEventsPerRequest",20);this._broker=new ye(e),this.maxEventsPerRequest=t??20}_createBatches(e){return e.flatMap(t=>t.createBatches(this.maxEventsPerRequest))}async flush(e){if(e.length===0)return[];const t=this._createBatches(e);let i=!1;for(let a=0;a<t.length;a++){const o=t[a];if(i){o.markAsFailAndRetry();continue}if(await this._sendbatch(o),o.shouldRetry){i=!0;break}}if(i)for(const a of t.filter(o=>o.shouldRetry))a.session.returnFailedEventsToQueue(a.events);return t}async sendHeartbeat(e){const{data:t}=await this._broker.sendHeartbeat(e);e.id=t.session_id,e.nextHeartbeatAt=new Date(t.next_heartbeat_at)}flushWithBeacon(e){if(e.length===0)return[];const t=this._createBatches(e);for(const i of t)this._sendItemWithBeaconAPI(i);return t}_sendItemWithBeaconAPI(e){const{session:t,events:i}=e;if(t.userAtomicId===null){e.markAsFailAndRetry();return}if(navigator.onLine===!1){e.markAsFailAndRetry();return}this.onEventsSending(new j(i)),this._broker.sendWithBeaconAPI(t,i)?e.markAsSent():e.markAsFailAndRetry()}async _sendbatch(e){const{session:t,events:i}=e;if(t.userAtomicId===null){e.markAsFailAndRetry();return}if(navigator.onLine===!1){e.markAsFailAndRetry();return}this.onEventsSending(new j(i));try{const{response:a,duration:o,data:u}=await this._broker.send(t,i);t.id=u.session_id,t.nextHeartbeatAt=new Date(u.next_heartbeat_at),this.onEventsSent(new be(i,a,o)),e.markAsSent()}catch(a){const o=a instanceof S?a.shouldRetry:!0,u=a instanceof S?a.duration:0;o?e.markAsFailAndRetry():e.markAsFailAndSkip(),this.onEventsFailed(new Se(i,a,u))}}}class Ae{constructor(e,t){s(this,"batches");s(this,"retryAfter");this.batches=e,this.retryAfter=t}}var k=(n=>(n.Other="other",n.Web="web",n.Desktop="desktop",n.Ios="ios",n.Android="android",n))(k||{});class _{constructor(){s(this,"_listeners",[])}add(e){this._listeners.push(e)}remove(e){const t=this._listeners.indexOf(e);t>=0&&this._listeners.splice(t,1)}emit(e){for(const t of this._listeners)t(e)}}class De{constructor(e){s(this,"sdkVersion",r.version);s(this,"gameVersion",null);s(this,"endpoint","");s(this,"platform",k.Web);s(this,"maxEventsPerRequest",20);s(this,"flushDebounceTime",15);s(this,"steamId");s(this,"_batchSending",new _);s(this,"_batchSent",new _);s(this,"_batchFailed",new _);s(this,"_eventQueued",new _);s(this,"_retryScheduled",new _);s(this,"_session",null);s(this,"_pendingSessions");s(this,"_isSending",!1);s(this,"_scheduler");s(this,"_dataCollector");s(this,"_storage");s(this,"_collectionContext");s(this,"_flushingService");if(!e.gameSlug)throw new Error("The game slug is required.");if(!e.endpoint)throw new Error("The endpoint is required.");this.endpoint=`${e.endpoint}/games/${e.gameSlug}`;const t=e.analytics??{};this.maxEventsPerRequest=t.maxEventsPerRequest??20,this.flushDebounceTime=t.flushDebounceTime??15,this._collectionContext={gameVersion:e.gameVersion??null,analyticsSdkVersion:this.sdkVersion,gamePlatform:e.gamePlatform??k.Web,gameStorefront:e.gameStorefront??null,gameLocale:r.locale,userUid:r.config.userUid??null,deviceGaid:t.deviceGaid??null,deviceIdfa:t.deviceIdfa??null,steamId:typeof t.steamId=="bigint"?t.steamId.toString():t.steamId??null},this._dataCollector=t.dataCollector??new U,this._storage=t.storageDriver??new pe,this._pendingSessions=new we(this._storage),this._flushingService=new Te(this.endpoint,this.maxEventsPerRequest),this._flushingService.onEventsSending=i=>this._batchSending.emit(i),this._flushingService.onEventsSent=i=>this._batchSent.emit(i),this._flushingService.onEventsFailed=i=>this._batchFailed.emit(i),this._scheduler=new ve(()=>this.flush(),this.flushDebounceTime),this._session=this._newSession(),this._pendingSessions.restore(),window.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&this._flushWithBeaconAPI()}),this._scheduler.scheduleNextFlush(),r.localeChanged.add(()=>this._handlePlaysaurusLocaleChanged())}get batchSending(){return this._batchSending}get batchSent(){return this._batchSent}get batchFailed(){return this._batchFailed}get eventQueued(){return this._eventQueued}get retryScheduled(){return this._retryScheduled}_handlePlaysaurusLocaleChanged(){this._collectionContext.gameLocale=r.locale,this.sendEvent("locale_changed",{locale:r.locale})}_newSession(){const e=new E;return this._session=e,this.sendEvent("session_started"),this._collectData(e),e}async endSession(){if(this._scheduler.clear(),!this._session)return Promise.resolve();this.sendEvent("session_ended"),await this.flush(),this._session=null}_getActiveSession(){return this._session??(this._session=this._newSession()),this._session}sendEvent(e,t){const i=this._getActiveSession(),a=i.pushEvent(e,t);this._pendingSessions.add(i),this._eventQueued.emit(new fe(a)),i.pendingEvents.length>=this.maxEventsPerRequest?this._scheduler.failedAttempts===0&&this.flush():this._scheduler.scheduleNextFlush()}async _collectData(e){e.userAtomicId===null&&(await this._dataCollector.collect(e,this._collectionContext),await this._pendingSessions.save())}async flush(){if(!this._isSending){this._isSending=!0;try{await this._pendingSessions.save();const e=this._pendingSessions.dequeueAll(),t=this._scheduler.isHeartbeatTime;if(e.length===0&&t&&this._session!==null){await this._flushingService.sendHeartbeat(this._session),this._isSending=!1;return}const a=(await this._flushingService.flush(e)).filter(o=>o.shouldRetry);a.length>0?(this._pendingSessions.addRange(a.map(o=>o.session)),this._scheduler.scheduleRetry(),this._retryScheduled.emit(new Ae(a,this._scheduler.retryTime))):this._scheduler.scheduleNextFlush(),await this._pendingSessions.save()}finally{this._session&&this._session.nextHeartbeatAt&&this._scheduler.scheduleHeartbeatAt(this._session.nextHeartbeatAt),this._isSending=!1}}}_flushWithBeaconAPI(){if(navigator.sendBeacon===void 0){this.flush();return}const e=this._pendingSessions.getAll(),t=e.filter(a=>a.id===null),i=e.filter(a=>a.id!==null);this._flushingService.flushWithBeacon(t),this._flushingService.flush(i)}}class ${constructor(){s(this,"id","");s(this,"locale","en");s(this,"title","");s(this,"body","");s(this,"button","");s(this,"link","");s(this,"image",{url:"",alt:""});s(this,"_sw",null);s(this,"_clicked",!1);s(this,"_finalReadTime",null)}static fromRequest(e){const t=new $;return t.id=e.id,t.locale=e.locale,t.title=e.title,t.body=e.body,t.button=e.button,t.link=e.link,t.image=e.image,t}start(){if(this._sw!==null)throw new Error("Announcement has already been started.");this._sw=F.start()}markAsClicked(){this.markAsDismissed(!0)}markAsDismissed(e=!1){if(this._sw===null)throw new Error("Announcement has not been started.");this._clicked=e,this._finalReadTime=this._sw.elapsed,this._sw=null}get isRunning(){return this._sw!==null}get clicked(){return this._clicked}get readTime(){return this._finalReadTime!==null?this._finalReadTime:this._sw===null?0:this._sw.elapsed}}class Ie{constructor(e,t){s(this,"_parent");s(this,"_announcement",null);s(this,"_dialog",null);s(this,"onClicked",()=>{});s(this,"onDismissed",()=>{});s(this,"_options");s(this,"_closeIconSvg",`
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
        </svg>
    `);this._announcement=e,this._parent=document.body,this._options=t||{},this.render()}get announcement(){return this._announcement}set announcement(e){this._announcement!==e&&(this._announcement=e,this.render())}render(){var le,ce;if(this._dialog===null&&(this._dialog=document.createElement("dialog"),this._dialog.classList.add("playsaurus-announcement-dialog"),this._dialog.classList.add(this._options.theme||"light"),this._parent.appendChild(this._dialog)),this._announcement===null){this._dialog.innerHTML="";return}const e=this._announcement.title,t=this._announcement.body,i=this._announcement.button||"Learn More",a=(le=this._announcement.image)==null?void 0:le.url,o=((ce=this._announcement.image)==null?void 0:ce.alt)||e,u=this._announcement.link,w=[];if(a&&w.push(`<img class="image" src="${a}" alt="${o}"/>`),t&&w.push(`<p class="body">${t}</p>`),u){const D=u.startsWith("http")?u:"javascript:void(0)";w.push(`<a href="${D}" target="_blank" class="button">
                ${i}
            </a>`)}const y=`<button class="close-button">${this._closeIconSvg}</button>`,xe=`<div class="header">
            <h1 class="title">${e}</h1>
            ${y}
        </div>`;this._dialog.innerHTML=`
            ${xe}
            ${w.join(`
`)}
        `;const ae=this._dialog.querySelector("a.button"),oe=this._dialog.querySelector("button.close-button");ae&&ae.addEventListener("click",D=>{var ue;u&&!u.startsWith("http")&&D.preventDefault(),(ue=this._dialog)==null||ue.close(),this.onClicked()}),oe&&oe.addEventListener("click",D=>{var C;D.preventDefault(),(C=this._dialog)==null||C.close(),this.onDismissed()}),this._options.dismissable&&this._dialog.addEventListener("click",D=>{var C;D.target===this._dialog&&((C=this._dialog)==null||C.close(),this.onDismissed())})}show(){var e;(e=this._dialog)==null||e.showModal()}}class Ee{constructor(e){s(this,"_endpoint");s(this,"platform");if(!e.gameSlug)throw new Error("The game slug is required");if(!e.endpoint)throw new Error("The endpoint is required");this._endpoint=`${e.endpoint}/games/${e.gameSlug}/announcements`,this.platform=e.gamePlatform||k.Web}async fetch(){const e=r.config.userUid||"",t=new URLSearchParams({user_uid:e,platform:this.platform,user_atomic_id:r.getAtomicId()}),i=await fetch(`${this._endpoint}/latest?${t.toString()}`,{headers:r.getDefaultHeaders()});if(!i.ok)throw new Error(`Failed to fetch latest announcement: ${i.status} ${i.statusText}`);if(i.status===204)return null;const a=await i.json();return $.fromRequest(a)}async fetchAndShowDialog(e){const t=await this.fetch();return this.showDialog(t,e)}async showDialog(e,t){return e?new Promise(i=>{const a=new Ie(e,t);a.onClicked=()=>{e.markAsClicked(),this.sendInteraction(e),i(e)},a.onDismissed=()=>{e.markAsDismissed(),this.sendInteraction(e),i(e)},e.start(),a.show()}):null}async sendInteraction(e){e.isRunning&&e.markAsDismissed();const t=await fetch(`${this._endpoint}/interactions`,{method:"POST",headers:r.getDefaultHeaders(),body:JSON.stringify({announcement_id:e.id,user_uid:r.config.userUid,user_atomic_id:r.getAtomicId(),read_time:e.readTime,clicked:e.clicked,locale:e.locale,platform:this.platform})});if(!t.ok)throw new Error(`Failed to send interaction: ${t.status} ${t.statusText}`)}}class p extends Error{constructor(t,i,a=null){super(`${t} (${i.status} ${i.statusText})`);s(this,"response");s(this,"data");this.response=i,this.data=a}get serverMessage(){return this.data instanceof Object&&"message"in this.data?this.data.message:null}get status(){return this.response.status}}class G extends p{constructor(t,i){super(`Validation error: ${t.status} ${t.statusText}`,t,i);s(this,"errors");this.errors=i instanceof Object&&"errors"in i?i.errors:{}}}class Q extends p{constructor(e,t=null){super("Unauthorized",e,t)}}class X extends p{constructor(e,t=null){super("Forbidden",e,t)}get reason(){return this.data instanceof Object&&"reason"in this.data?this.data.reason:null}}class K extends p{constructor(e,t=null){super("Too many requests",e,t)}}class Y extends p{constructor(e,t=null){super("The server is under maintenance",e,t)}get serverMessage(){return super.serverMessage==="Service Unavailable"||!super.serverMessage?null:super.serverMessage}}class h{static async assertOk(e){const t=async()=>{var a;return((a=e.headers.get("content-type"))==null?void 0:a.includes("application/json"))?await e.json():await e.text()};if(e.status===422)throw new G(e,await t());if(e.status===429)throw new K(e,await t());if(e.status===401)throw r.authToken=null,new Q(e,await t());if(e.status===403)throw new X(e,await t());if(e.status===503)throw new Y(e,await t());if(!e.ok)throw new p("Failed to fetch data",e,await t())}}var v=(n=>(n.Int="int",n.Double="double",n.String="string",n.Json="json",n.None="none",n))(v||{});class H{constructor(){s(this,"code","");s(this,"message",null);s(this,"rewardType","");s(this,"value",null);s(this,"valueDataType",v.None)}static fromJson(e){const t=new H;return t.code=e.code,t.message=e.message,t.rewardType=e.reward_type,t.valueDataType=e.reward_data_type,t.value=this._parseValue(e.reward_value,t.valueDataType),t}static _parseValue(e,t){switch(t){case v.Int:return parseInt(e,10);case v.Double:return parseFloat(e);case v.String:return e;case v.Json:return JSON.parse(e);case v.None:return null;default:return null}}}class Z extends p{constructor(e,t=null){const i=t instanceof Object&&"message"in t?t.message:"Failed to redeem coupon";super(i,e,t)}}class ke{constructor(e){s(this,"_endpoint");if(!e.gameSlug)throw new Error("The game slug is required");if(!e.endpoint)throw new Error("The endpoint is required");this._endpoint=`${e.endpoint}/games/${e.gameSlug}/coupons`}async redeem(e){const t=await fetch(`${this._endpoint}/redeem`,{method:"POST",headers:r.getDefaultHeaders(),body:JSON.stringify({code:e,user_atomic_id:r.getAtomicId(),user_uid:r.config.userUid,platform:r.config.gamePlatform})}),i=await t.json();if(t.status===400)throw new Z(t,i);return await h.assertOk(t),H.fromJson(i)}}class Ce extends U{async initialize(){return new Promise((e,t)=>{const i=setTimeout(()=>e(),5e3);document.addEventListener("deviceready",()=>{clearTimeout(i),e()})})}getDeviceModel(){return device?device.model:null}getDeviceManufacturer(){return device?device.manufacturer:null}getOsName(){var e,t;if(!device)return null;switch((t=(e=device.platform)==null?void 0:e.toLowerCase())==null?void 0:t.replace(" ","")){case"ios":return O.IOS;case"android":return O.Android;case"windows":return O.Windows;case"macos":case"macosx":return O.MacOS}return null}getOsVersion(){return device?device.version:null}}class ee{constructor(e){s(this,"method");this.method=e}get success(){return this.method!==V.None}}class Oe{constructor(e){s(this,"error");this.error=e}get message(){var e;return(e=this.error)==null?void 0:e.message}}class b{static generateDeviceName(){const e=navigator.userAgentData;if(e&&e.brands&&e.brands.length>0){const o=e.brands.map(y=>[b._simplifyBrandName(y.brand),y.brand]).filter(y=>!b._isInvalidBrand(y[0])).map(y=>y[1]),u=o[o.length-1],w=e.platform||"";return w?`${u} on ${w}`.trim():u.trim()}const t=window.navigator.userAgent,i=b._getBrowserFromUA(t),a=b._getPlatformFromNavigatorPlatform(window.navigator.platform||"");return a?`${i} on ${a}`.trim():i.trim()}static _simplifyBrandName(e){return e.toLowerCase().replace(/[^a-z]/g,"")}static _isInvalidBrand(e){return e.includes("notabrand")||e.includes("notbrand")||e.includes("chromium")}static _getBrowserFromUA(e){return e.indexOf("Edg")>-1?"Microsoft Edge":e.indexOf("Chrome")>-1?"Chrome":e.indexOf("Firefox")>-1?"Firefox":e.indexOf("Safari")>-1?"Safari":e.indexOf("Opera")>-1?"Opera":e.indexOf("Trident")>-1||e.indexOf("MSIE")>-1?"Internet Explorer":"Unknown Browser"}static _getPlatformFromNavigatorPlatform(e){return e?e.indexOf("Mac")===0?"Mac":e.indexOf("Win")>0?"Windows":e.indexOf("Linux")===0?"Linux":e:""}}var te=(n=>(n.Default="default",n.Login="login",n.Register="register",n))(te||{}),V=(n=>(n.None="none",n.ClassicLogin="classic_login",n.ClassicRegister="classic_register",n.ConfirmLogin="confirm_login",n))(V||{});class Pe{constructor(e){s(this,"_iframe");s(this,"_container");s(this,"_options");s(this,"_origin");s(this,"_url");s(this,"_returned",new _);s(this,"_loaded",new _);s(this,"_closed",new _);s(this,"_failed",new _);s(this,"_iframeTimeout",null);s(this,"_isLoading",!1);var i;this._options=e,(i=this._options).showClose??(i.showClose=!1),this._container=e.container instanceof HTMLElement?e.container:document.querySelector(e.container);const t=e.deviceName||b.generateDeviceName();this._url=this._getFinalUrl(e.url,t).toString(),this._origin=new URL(this._url).origin,this._handleMessage=this._handleMessage.bind(this),this._handleReady=this._handleReady.bind(this)}open(){return this._iframe?this:(this._iframe=document.createElement("iframe"),this._iframe.style.width="100%",this._iframe.style.height="100%",this._iframe.style.border="none",this._iframe.referrerPolicy="no-referrer-when-downgrade",this._iframe.style.visibility="hidden",this._options.iFrameClass&&this._iframe.classList.add(this._options.iFrameClass),this._container.appendChild(this._iframe),window.addEventListener("message",this._handleMessage),this._iframe.addEventListener("error",e=>this._handleError(e.error)),this._isLoading=!0,this._iframe.src=this._url,this._iframeTimeout=setTimeout(()=>{this._handleError(new Error("The auth frame took too long to load."))},(this._options.timoutSeconds||10)*1e3),this)}get isLoading(){return this._isLoading}get iFrame(){return this._iframe}get returned(){return this._returned}get loaded(){return this._loaded}get closed(){return this._closed}get failed(){return this._failed}_clearIframeTimeout(){this._iframeTimeout&&(clearTimeout(this._iframeTimeout),this._iframeTimeout=null)}close(){this._iframe&&(this._clearIframeTimeout(),this._isLoading=!1,window.removeEventListener("message",this._handleMessage),this._container.removeChild(this._iframe),this._iframe=void 0,this._closed.emit())}_handleMessage(e){if(e.origin!==this._origin){console.warn(`Expected message from ${this._origin}, but received message from ${e.origin}`),console.warn(e);return}const t=e.data;switch(t.type){case"READY":this._handleReady(t);break;case"SUCCESS":this._handleSuccess(t);break;case"CLOSE":this._handleClose(t);break;default:console.warn("Received unknown message from auth frame:"),console.warn(t)}}_handleReady(e){this._iframe&&this._isLoading&&(this._clearIframeTimeout(),this._isLoading=!1,this._iframe.style.visibility="visible",this._loaded.emit())}_handleError(e){this._iframe&&this._isLoading&&(this._clearIframeTimeout(),console.error("An error occurred while loading the auth frame:"),console.error(e),this._failed.emit(new Oe(e)))}_handleSuccess(e){const{token:t,method:i}=e;r.authToken=t,this.close(),this._returned.emit(new ee(i))}_handleClose(e){this.close(),this._returned.emit(new ee("none"))}_getDefaultUrl(){return new URL("/embed/auth",new URL(r.config.endpoint).origin)}_getFinalUrl(e,t){const i=e?new URL(e):this._getDefaultUrl();return i.search=new URLSearchParams({game:r.config.gameSlug,parent_uri:window.location.origin,device_name:t,user_atomic_id:r.getAtomicId(),user_uid:r.config.userUid||"",platform:r.config.gamePlatform||"",action:this._options.action||"default",show_close:this._options.showClose?"1":"0"}).toString(),i}}class T{constructor(){s(this,"id",0);s(this,"playTime",0);s(this,"platform",null);s(this,"gameVersion","");s(this,"filename","");s(this,"fileSize",0);s(this,"metadata",{});s(this,"createdAt",null);s(this,"updatedAt",null);s(this,"startedPlayingAt",null)}static fromResponse(e){const t=new T;return t.id=e.id,t.playTime=e.play_time,t.platform=e.platform,t.gameVersion=e.game_version,t.filename=e.filename,t.fileSize=e.file_size,t.metadata=e.metadata,t.createdAt=new Date(e.created_at),t.updatedAt=new Date(e.updated_at),t.startedPlayingAt=e.started_playing_at?new Date(e.started_playing_at):null,t}}const A=class A{constructor(e,t,i){s(this,"amount","0.00");s(this,"currency","USD");s(this,"_formatted");if(typeof e!="string"||e.length===0)throw new Error("The amount must be a non-empty string");this.amount=e,this.currency=t,this._formatted=i}static fromJson(e){if(!e.amount||!e.currency)throw new Error("Invalid Money JSON");return new A(e.amount,e.currency,e.formatted??null)}static zero(e){let t=A._zeros.get(e);return t||(t=new A("0.00",e),A._zeros.set(e,t)),t}get minorUnits(){return parseInt(this.amount.replace(".",""),10)}get formatted(){return this._formatted??(this._formatted=new Intl.NumberFormat(r.locale,{style:"currency",currency:this.currency}).format(parseFloat(this.amount)))}toString(){return`${this.amount} ${this.currency}`}toJSON(){return{amount:this.amount,currency:this.currency}}};s(A,"_zeros",new Map);let g=A;var P=(n=>(n.Pending="pending",n.Valid="valid",n.Invalid="invalid",n.Unverified="unverified",n.Canceled="canceled",n.Error="error",n))(P||{});class R{constructor(){s(this,"id","");s(this,"validationStatus",P.Pending);s(this,"validatedAt",null);s(this,"platform",null);s(this,"storefront",null);s(this,"paymentGateway",null);s(this,"transactionId","");s(this,"price",g.zero("XXX"));s(this,"priceUsd",g.zero("USD"));s(this,"createdAt",new Date)}static fromJson(e){const t=new R;return t.id=e.id,t.validationStatus=e.validation_status,t.validatedAt=new Date(e.validated_at),t.platform=e.platform,t.storefront=e.storefront,t.paymentGateway=e.payment_gateway,t.transactionId=e.transaction_id,t.price=g.fromJson(e.price),t.priceUsd=g.fromJson(e.price_usd),t.createdAt=new Date(e.created_at),t}get isValid(){return this.validationStatus===P.Valid||this.validationStatus===P.Unverified}}class L{constructor(){s(this,"priceLocalizationId",null);s(this,"requested",g.zero("USD"));s(this,"localized",g.zero("USD"));s(this,"localizedUsd",g.zero("USD"))}static fromJson(e){const t=new L;return t.priceLocalizationId=e.price_localization_id||null,t.requested=g.fromJson(e.requested),t.localized=g.fromJson(e.localized),t.localizedUsd=g.fromJson(e.localized_usd),t}}var se=(n=>(n.General="general",n.Bundle="bundle",n))(se||{}),ie=(n=>(n.Steam="steam",n.GooglePlay="google_play",n.AppStore="app_store",n.PayPal="paypal",n.Stripe="stripe",n.ArmorGames="armor_games",n))(ie||{}),ne=(n=>(n.Male="male",n.Female="female",n.NonBinaryOther="non_binary_other",n.PreferNotToSay="prefer_not_to_say",n))(ne||{}),re=(n=>(n.PlaysaurusWeb="playsaurus_web",n.Steam="steam",n.AppStore="app_store",n.GooglePlay="google_play",n.AmazonAppstore="amazon_appstore",n.CoolMathGames="cool_math_games",n.ArmorGames="armor_games",n.CrazyGames="crazy_games",n.Microsoft="microsoft",n.MicrosoftStore="microsoft_store",n.MicrosoftStart="microsoft_start",n))(re||{});class c{}s(c,"BrowserDataCollector",U),s(c,"CordovaDataCollector",Ce),s(c,"PlaysaurusNetworkError",p),s(c,"PlaysaurusValidationError",G),s(c,"PlaysaurusUnauthorizedError",Q),s(c,"PlaysaurusTooManyRequestsError",K),s(c,"PlaysaurusForbiddenError",X),s(c,"PlaysaurusMaintenanceError",Y),s(c,"CouponRedeemError",Z),s(c,"CouponRewardDataType",v),s(c,"CloudSave",T),s(c,"AuthFrameMethod",V),s(c,"AuthFrameAction",te),s(c,"Money",g),s(c,"Purchase",R),s(c,"LocalizationResult",L),s(c,"ProductType",se),s(c,"PaymentGateway",ie),s(c,"Gender",ne),s(c,"GamePlatform",k),s(c,"GameStorefront",re),s(c,"PurchaseValidationStatus",P);class B{constructor(){s(this,"id",0);s(this,"displayName","");s(this,"name",null);s(this,"username","");s(this,"email","");s(this,"gender",null);s(this,"dateOfBirth",null);s(this,"emailVerifiedAt",null);s(this,"createdAt",null);s(this,"updatedAt",null);s(this,"editProfileLink",null);s(this,"avatarUrl","")}static fromResponse(e){const t=new B;return t.id=e.id,t.displayName=e.display_name,t.name=e.name??null,t.username=e.username,t.gender=e.gender??null,t.dateOfBirth=e.date_of_birth?new Date(e.date_of_birth):null,t.email=e.email,t.emailVerifiedAt=e.email_verified_at?new Date(e.email_verified_at):null,t.createdAt=new Date(e.created_at),t.updatedAt=new Date(e.updated_at),t.editProfileLink=e.edit_profile_link??null,t.avatarUrl=e.avatar_url,t}}class Re{constructor(e){s(this,"_endpoint");if(!e.gameSlug)throw new Error("The game slug is required");if(!e.endpoint)throw new Error("The endpoint is required");this._endpoint=e.endpoint}async register(e){const t=await fetch(`${this._endpoint}/register`,{method:"POST",headers:r.getDefaultHeaders(),body:JSON.stringify({name:e.name||null,username:e.username,email:e.email,password:e.password,password_confirmation:e.passwordConfirmation,game:r.config.gameSlug,device_name:e.deviceName||this.generateDeviceName(),user_atomic_id:r.getAtomicId(),user_uid:r.config.userUid,platform:r.config.gamePlatform,terms_of_service:!!e.termsOfService})});await h.assertOk(t);const i=await t.json();r.authToken=i.token}async login(e){const t=await fetch(`${this._endpoint}/login`,{method:"POST",headers:r.getDefaultHeaders(),body:JSON.stringify({email:e.email,password:e.password,device_name:e.deviceName||this.generateDeviceName(),game:r.config.gameSlug,user_atomic_id:r.getAtomicId(),user_uid:r.config.userUid,platform:r.config.gamePlatform})});await h.assertOk(t);const i=await t.json();r.authToken=i.token}async logout(){const e=await fetch(`${this._endpoint}/logout`,{method:"POST",headers:r.getDefaultHeaders()});await h.assertOk(e),r.authToken=null}async resetPassword(e){const t=await fetch(`${this._endpoint}/password/email`,{method:"POST",headers:r.getDefaultHeaders(),body:JSON.stringify({email:e.email})});return await h.assertOk(t),await t.json()}async getProfile(){const e=await fetch(`${this._endpoint}/profile`,{method:"GET",headers:r.getDefaultHeaders()});await h.assertOk(e);const t=await e.json();return B.fromResponse(t.data)}async resendEmailVerification(){const e=await fetch(`${this._endpoint}/email/verification-notification`,{method:"POST",headers:r.getDefaultHeaders()});await h.assertOk(e);const t=await e.json();return{message:t.message,emailVerifiedAt:t.email_verified_at?new Date(t.email_verified_at):null}}get isLoggedIn(){return!!r.authToken}get authToken(){return r.authToken}generateDeviceName(){return b.generateDeviceName()}createAuthFrame(e){return new Pe(e)}}class Me{constructor(e){s(this,"_endpoint");if(!e.gameSlug)throw new Error("The game slug is required");if(!e.endpoint)throw new Error("The endpoint is required");this._endpoint=`${e.endpoint}/games/${e.gameSlug}/cloud-saves`}_getFormData(e,t=null){var o;const i=new FormData;i.append("file",e.file,e.fileName||"save.dat");const a={play_time:Math.floor(e.playTime).toString(),started_playing_at:((o=e.startedPlayingAt)==null?void 0:o.toISOString())??void 0,metadata:JSON.stringify(e.metadata),game_version:r.config.gameVersion,platform:r.config.gamePlatform,user_atomic_id:r.getAtomicId(),user_uid:r.config.userUid};for(const u in a)i.append(u,a[u]??"");return t&&i.append("_method",t),i}async create(e){const t=await fetch(this._endpoint,{method:"POST",headers:r.getDefaultHeaders(!1),body:this._getFormData(e)});await h.assertOk(t);const i=await t.json();return T.fromResponse(i.data)}async update(e,t){const i=await fetch(`${this._endpoint}/${e}`,{method:"POST",headers:r.getDefaultHeaders(!1),body:this._getFormData(t,"PUT")});await h.assertOk(i);const a=await i.json();return T.fromResponse(a.data)}async updateOrCreate(e,t){if(!e||e<=0)return await this.create(t);try{return await this.update(e,t)}catch(i){if(i instanceof p&&(i.status===404||i.status===403))return await this.create(t);throw i}}async getAll(){const e=await fetch(this._endpoint,{method:"GET",headers:r.getDefaultHeaders()});return await h.assertOk(e),(await e.json()).data.map(i=>T.fromResponse(i))}async get(e){const t=await fetch(`${this._endpoint}/${e}`,{method:"GET",headers:r.getDefaultHeaders()});await h.assertOk(t);const i=await t.json();return T.fromResponse(i.data)}async delete(e){const t=await fetch(`${this._endpoint}/${e}`,{method:"DELETE",headers:r.getDefaultHeaders()});await h.assertOk(t)}async download(e){const t=await fetch(`${this._endpoint}/${e}/file`,{method:"GET",headers:r.getDefaultHeaders()});return await h.assertOk(t),t.blob()}}let ze=class{constructor(e){s(this,"_endpoint");if(!e.gameSlug)throw new Error("The game slug is required");if(!e.endpoint)throw new Error("The endpoint is required");this._endpoint=`${e.endpoint}/games/${e.gameSlug}/purchases`}async store(e){const t=await fetch(this._endpoint,{method:"POST",headers:r.getDefaultHeaders(),body:JSON.stringify({sku:e.sku,price:e.price.toJSON(),transaction_id:e.transactionId,product_type:e.productType??null,price_localization_id:e.priceLocalizationId??null,payment_gateway:e.paymentGateway??null,user_atomic_id:r.getAtomicId(),user_uid:r.config.userUid,platform:r.config.gamePlatform??null,storefront:r.config.gameStorefront??null})});await h.assertOk(t);const i=await t.json();return R.fromJson(i.data)}async get(e){if(!e)throw new Error("The purchase ID is required");const t=await fetch(`${this._endpoint}/${e}`,{method:"GET",headers:r.getDefaultHeaders()});await h.assertOk(t);const i=await t.json();return R.fromJson(i.data)}};class q{constructor(e){s(this,"_endpoint");if(!e.gameSlug)throw new Error("The game slug is required");if(!e.endpoint)throw new Error("The endpoint is required");this._endpoint=`${e.endpoint}/games/${e.gameSlug}/prices`}static _assertUsd(e){for(const t of e)if(t.currency!=="USD")throw new Error(`The price must be in USD. Received: ${t}`)}async localize(e){return(await this.localizeMany({prices:[e.price],expectedCountry:e.expectedCountry,expectedCurrency:e.expectedCurrency,productType:e.productType}))[0]}async localizeMany(e){q._assertUsd(e.prices);const t=await fetch(this._endpoint,{method:"POST",headers:r.getDefaultHeaders(),body:JSON.stringify({prices:e.prices.map(a=>a.toJSON()),expected_country:e.expectedCountry,expected_currency:e.expectedCurrency,product_type:e.productType??null,platform:r.config.gamePlatform,user_atomic_id:r.getAtomicId(),user_uid:r.config.userUid,storefront:r.config.gameStorefront})});return await h.assertOk(t),(await t.json()).data.map(a=>L.fromJson(a))}}const d=class d extends c{static get locale(){var e;return((e=this._config)==null?void 0:e.locale)??"en"}static set locale(e){if(e!==this.locale){if(!this._config)throw new Error("The Playsaurus SDK has not been initialized. Call Playsaurus.initialize() first.");this._config.locale=e.replace("_","-"),this._localeChanged.emit()}}static get localeChanged(){return this._localeChanged}static get authTokenChanged(){return this._authTokenChanged}static initialize(e){var i;if(this._instance!==null)throw new Error("The Playsaurus SDK has already been initialized.");const t=e.endpoint||d.DEFAULT_ENDPOINT;e.endpoint=t==null?void 0:t.replace(/\/$/,""),e.locale??(e.locale=navigator.language||"en"),e.gamePlatform??(e.gamePlatform=k.Web),this._config=e,this._authToken=window.localStorage.getItem("playsaurus-auth-token"),this._authToken=this._authToken===""?null:this._authToken,(((i=e.analytics)==null?void 0:i.enabled)??!1)&&(this._analytics=new De(e))}static get isInitialized(){return this._config!==null}static _assertInitialized(){if(!this._config)throw new Error("The Playsaurus SDK has not been initialized. Call Playsaurus.initialize() first.")}static get config(){return this._assertInitialized(),this._config}static get analytics(){if(this._assertInitialized(),!this._analytics)throw new Error("The analytics service has not been enabled. Enable it in the PlaysaurusConfig.");return this._analytics}static get announcements(){return this._assertInitialized(),this._announcements??(this._announcements=new Ee(this._config))}static get coupons(){return this._assertInitialized(),this._coupons??(this._coupons=new ke(this._config))}static get auth(){return this._assertInitialized(),this._auth??(this._auth=new Re(this._config))}static get cloudSaves(){return this._assertInitialized(),this._cloudSaves??(this._cloudSaves=new Me(this._config))}static get purchases(){return this._assertInitialized(),this._purchases??(this._purchases=new ze(this._config))}static get prices(){return this._assertInitialized(),this._prices??(this._prices=new q(this._config))}static getAtomicId(){return x.instance.getId()}static get authToken(){return this._authToken}static set authToken(e){e!==this._authToken&&(this._authToken=e,window.localStorage.setItem("playsaurus-auth-token",e??""),this._authTokenChanged.emit())}static getDefaultHeaders(e=!0){var t,i;return{...this._authToken?{Authorization:`Bearer ${this._authToken}`}:{},...e?{"Content-Type":"application/json"}:{},Accept:"application/json","Accept-Language":this.locale,"X-Requested-With":"XMLHttpRequest","X-Playsaurus-API-Version":"1",...(t=this._config)!=null&&t.gamePlatform?{"X-Playsaurus-Game-Platform":this._config.gamePlatform}:{},...(i=this._config)!=null&&i.gameVersion?{"X-Playsaurus-Game-Version":this._config.gameVersion}:{}}}};s(d,"version","9.7.0"),s(d,"DEFAULT_ENDPOINT","https://app.playsaurus.com/api"),s(d,"_instance",null),s(d,"_analytics",null),s(d,"_announcements",null),s(d,"_coupons",null),s(d,"_auth",null),s(d,"_cloudSaves",null),s(d,"_purchases",null),s(d,"_prices",null),s(d,"_config",null),s(d,"_authToken",null),s(d,"_localeChanged",new _),s(d,"_authTokenChanged",new _);let r=d;return r});
