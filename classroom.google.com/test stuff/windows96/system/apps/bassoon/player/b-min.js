/*BassoonTracker v0.4.0 by Steffest - build 2021-04-19 - Full source on https://github.com/steffest/BassoonTracker */
var BassoonTracker=function(){function M(e,t){function o(e){(e=0===e?e:e||i.index)<0&&(e=0),i.length<=e&&(e=i.length-1),i.index=e}var i={index:0,_N:!t,goto:function(e){o(e)},jump:function(e){this.goto(this.index+e)},readByte:function(e){o(e);var t=this.dataView.getInt8(this.index);return this.index++,t},writeByte:function(e,t){o(t),this.dataView.setInt8(this.index,e),this.index++},_e:function(e){o(e);var t=this.dataView.getUint8(this.index);return this.index++,t},_f:function(e,t){o(t),this.dataView.setUint8(this.index,e),this.index++},readUint:function(e){o(e);var t=this.dataView.getUint32(this.index,this._N);return this.index+=4,t},writeUint:function(e,t){o(t),this.dataView.setUint32(this.index,e,this._N),this.index+=4},readBytes:function(e,t){o(t);var n=new Uint8Array(e),a=this.index;(e+=a)>this.length&&(e=this.length);for(var r=0;a<e;++a)n.setUint8(r++,this.dataView.getUint8(a));return this.index=e,n},_v:function(e,t){o(t);var n=this.index,a=this.dataView,r="";for((e+=n)>this.length&&(e=this.length);n<e;++n){var i=a.getUint8(n);if(0==i)break;r+=String.fromCharCode(i)}return this.index=e,r},writeString:function(e,t){o(t);for(var n=this.dataView,a=e.length,r=0;r<a;r++)n.setUint8(this.index+r,e.charCodeAt(r));this.index+=a},_I:function(e,t,n,a){o(a),n=n||0;var r=(e=e||"").length;(t=t||1)<r&&(e=e.substr(0,t)),i.writeString(e),i.fill(n,t-r)},_g:function(e){o(e);var t=this.dataView.getUint16(this.index,this._N);return this.index+=2,t},_h:function(e,t){o(t),this.dataView.setUint16(this.index,e,this._N),this.index+=2}};return i.readLong=i.$c=i.readUint,i.writeLong=i.writeDWord=i.writeUint,i.readShort=function(e,t){o(t);var n=this.dataView.getInt16(this.index,this._N);return this.index+=2,n},i.clear=function(e){i.fill(0,e)},i.fill=function(e,t){e=e||0,t=t||0;for(var n=0;n<t;n++)i.writeByte(e)},i.isEOF=function(e){return this.length-(e=e||0)<=this.index},e&&(i.buffer=e,i.dataView=new DataView(e),i.length=e.byteLength),i}var e,t,o,B=((t={}).$f=!0,t.useDropbox=!0,t.showInternalMenu=!0,t.useWebWorkers=!0,t.useInitialLoad=!0,t.init=function(){"object"==typeof HostBridge&&((e=HostBridge).init(),"boolean"==typeof e.$f&&(t.$f=e.$f),"boolean"==typeof e.useDropbox&&(t.useDropbox=e.useDropboxs),"boolean"==typeof e.showInternalMenu&&(t.showInternalMenu=e.showInternalMenu),"boolean"==typeof e.useWebWorkers&&(t.useWebWorkers=e.useWebWorkers))},t.getBaseUrl=function(){return e&&e.getBaseUrl?e.getBaseUrl():"undefined"!=typeof Settings&&Settings.baseUrl||""},t.getRemoteUrl=function(){return e&&e.getRemoteUrl?e.getRemoteUrl():""},t.getVersionNumber=function(){return"undefined"!=typeof versionNumber?versionNumber:e&&e.getVersionNumber?e.getVersionNumber():"dev"},t.getBuildNumber=function(){return"undefined"!=typeof buildNumber?buildNumber:e&&e.getBuildNumber?e.getBuildNumber():(new Date).getTime()},t.signalReady=function(){e&&e.signalReady&&e.signalReady()},t.putFile=function(e,t){},t),S={images:{},audio:{},json:{},arrayBuffer:{}},G=void 0,s=1,F=2,$=1,W=2,z=3,X=4,K=5,c=7,Z=8,J=9,Q=10,Y=11,ee=12,E=13,te=16,ne=17,ae=24,re=26,ie=28,oe=29,f=33,n=36,u=46,se=53,ue=54,_e=55,le=56,ce=1,fe=2,r=1,p=2,d=3,P=1,V=2,pe={C1:{_b:856,_a:"C-1",tune:[907,900,894,887,881,875,868,862,856,850,844,838,832,826,820,814]},Cs1:{_b:808,_a:"C#1",tune:[856,850,844,838,832,826,820,814,808,802,796,791,785,779,774,768]},D1:{_b:762,_a:"D-1",tune:[808,802,796,791,785,779,774,768,762,757,752,746,741,736,730,725]},Ds1:{_b:720,_a:"D#1",tune:[762,757,752,746,741,736,730,725,720,715,709,704,699,694,689,684]},E1:{_b:678,_a:"E-1",tune:[720,715,709,704,699,694,689,684,678,674,670,665,660,655,651,646]},F1:{_b:640,_a:"F-1",tune:[678,675,670,665,660,655,651,646,640,637,632,628,623,619,614,610]},Fs1:{_b:604,_a:"F#1",tune:[640,636,632,628,623,619,614,610,604,601,597,592,588,584,580,575]},G1:{_b:570,_a:"G-1",tune:[604,601,597,592,588,584,580,575,570,567,563,559,555,551,547,543]},Gs1:{_b:538,_a:"G#1",tune:[570,567,563,559,555,551,547,543,538,535,532,528,524,520,516,513]},A1:{_b:508,_a:"A-1",tune:[538,535,532,528,524,520,516,513,508,505,502,498,495,491,487,484]},As1:{_b:480,_a:"A#1",tune:[508,505,502,498,494,491,487,484,480,477,474,470,467,463,460,457]},B1:{_b:453,_a:"B-1",tune:[480,477,474,470,467,463,460,457,453,450,447,444,441,437,434,431]},C2:{_b:428,_a:"C-2",tune:[453,450,447,444,441,437,434,431,428,425,422,419,416,413,410,407]},Cs2:{_b:404,_a:"C#2",tune:[428,425,422,419,416,413,410,407,404,401,398,395,392,390,387,384]},D2:{_b:381,_a:"D-2",tune:[404,401,398,395,392,390,387,384,381,379,376,373,370,368,365,363]},Ds2:{_b:360,_a:"D#2",tune:[381,379,376,373,370,368,365,363,360,357,355,352,350,347,345,342]},E2:{_b:339,_a:"E-2",tune:[360,357,355,352,350,347,345,342,339,337,335,332,330,328,325,323]},F2:{_b:320,_a:"F-2",tune:[339,337,335,332,330,328,325,323,320,318,316,314,312,309,307,305]},Fs2:{_b:302,_a:"F#2",tune:[320,318,316,314,312,309,307,305,302,300,298,296,294,292,290,288]},G2:{_b:285,_a:"G-2",tune:[302,300,298,296,294,292,290,288,285,284,282,280,278,276,274,272]},Gs2:{_b:269,_a:"G#2",tune:[285,284,282,280,278,276,274,272,269,268,266,264,262,260,258,256]},A2:{_b:254,_a:"A-2",tune:[269,268,266,264,262,260,258,256,254,253,251,249,247,245,244,242]},As2:{_b:240,_a:"A#2",tune:[254,253,251,249,247,245,244,242,240,239,237,235,233,232,230,228]},B2:{_b:226,_a:"B-2",tune:[240,238,237,235,233,232,230,228,226,225,224,222,220,219,217,216]},C3:{_b:214,_a:"C-3",tune:[226,225,223,222,220,219,217,216,214,213,211,209,208,206,205,204]},Cs3:{_b:202,_a:"C#3",tune:[214,212,211,209,208,206,205,203,202,201,199,198,196,195,193,192]},D3:{_b:190,_a:"D-3",tune:[202,200,199,198,196,195,193,192,190,189,188,187,185,184,183,181]},Ds3:{_b:180,_a:"D#3",tune:[190,189,188,187,185,184,183,181,180,179,177,176,175,174,172,171]},E3:{_b:170,_a:"E-3",tune:[180,179,177,176,175,174,172,171,170,169,167,166,165,164,163,161]},F3:{_b:160,_a:"F-3",tune:[170,169,167,166,165,164,163,161,160,159,158,157,156,155,154,152]},Fs3:{_b:151,_a:"F#3",tune:[160,159,158,157,156,155,154,152,151,150,149,148,147,146,145,144]},G3:{_b:143,_a:"G-3",tune:[151,150,149,148,147,146,145,144,143,142,141,140,139,138,137,136]},Gs3:{_b:135,_a:"G#3",tune:[143,142,141,140,139,138,137,136,135,134,133,132,131,130,129,128]},A3:{_b:127,_a:"A-3",tune:[135,134,133,132,131,130,129,128,127,126,125,125,124,123,122,121]},As3:{_b:120,_a:"A#3",tune:[127,126,125,125,123,123,122,121,120,119,118,118,117,116,115,114]},B3:{_b:113,_a:"B-3",tune:[120,119,118,118,117,116,115,114,113,113,112,111,110,109,109,108]}},de={None:{_a:"---"},C0:{_a:"C-0",_b:6848},Cs0:{_a:"C#0",_b:6464},D0:{_a:"D-0",_b:6096},Ds0:{_a:"D#0",_b:5760},E0:{_a:"E-0",_b:5424},F0:{_a:"F-0",_b:5120},Fs0:{_a:"F#0",_b:4832},G0:{_a:"G-0",_b:4560},Gs0:{_a:"G#0",_b:4304},A0:{_a:"A-0",_b:4064},As0:{_a:"A#0",_b:3840},B0:{_a:"B-0",_b:3624},C1:{_a:"C-1",_b:3424},Cs1:{_a:"C#1",_b:3232},D1:{_a:"D-1",_b:3048},Ds1:{_a:"D#1",_b:2880},E1:{_a:"E-1",_b:2712},F1:{_a:"F-1",_b:2560},Fs1:{_a:"F#1",_b:2416},G1:{_a:"G-1",_b:2280},Gs1:{_a:"G#1",_b:2152},A1:{_a:"A-1",_b:2032},As1:{_a:"A#1",_b:1920},B1:{_a:"B-1",_b:1812},C2:{_a:"C-2",_b:1712},Cs2:{_a:"C#2",_b:1616},D2:{_a:"D-2",_b:1524},Ds2:{_a:"D#2",_b:1440},E2:{_a:"E-2",_b:1356},F2:{_a:"F-2",_b:1280},Fs2:{_a:"F#2",_b:1208},G2:{_a:"G-2",_b:1140},Gs2:{_a:"G#2",_b:1076},A2:{_a:"A-2",_b:1016},As2:{_a:"A#2",_b:960},B2:{_a:"B-2",_b:906},C3:{_a:"C-3",_b:856},Cs3:{_a:"C#3",_b:808},D3:{_a:"D-3",_b:762},Ds3:{_a:"D#3",_b:720},E3:{_a:"E-3",_b:678},F3:{_a:"F-3",_b:640},Fs3:{_a:"F#3",_b:604},G3:{_a:"G-3",_b:570},Gs3:{_a:"G#3",_b:538},A3:{_a:"A-3",_b:508},As3:{_a:"A#3",_b:480},B3:{_a:"B-3",_b:453},C4:{_a:"C-4",_b:428},Cs4:{_a:"C#4",_b:404},D4:{_a:"D-4",_b:381},Ds4:{_a:"D#4",_b:360},E4:{_a:"E-4",_b:339},F4:{_a:"F-4",_b:320},Fs4:{_a:"F#4",_b:302},G4:{_a:"G-4",_b:285},Gs4:{_a:"G#4",_b:269},A4:{_a:"A-4",_b:254},As4:{_a:"A#4",_b:240},B4:{_a:"B-4",_b:226.5,_k:226},C5:{_a:"C-5",_b:214},Cs5:{_a:"C#5",_b:202},D5:{_a:"D-5",_b:190.5,_k:190},Ds5:{_a:"D#5",_b:180},E5:{_a:"E-5",_b:169.5,_k:170},F5:{_a:"F-5",_b:160},Fs5:{_a:"F#5",_b:151},G5:{_a:"G-5",_b:142.5,_k:143},Gs5:{_a:"G#5",_b:134.5,_k:135},A5:{_a:"A-5",_b:127},As5:{_a:"A#5",_b:120},B5:{_a:"B-5",_b:113.25,_k:113},C6:{_a:"C-6",_b:107},Cs6:{_a:"C#6",_b:101},D6:{_a:"D-6",_b:95.25,_k:95},Ds6:{_a:"D#6",_b:90},E6:{_a:"E-6",_b:84.75,_k:85},F6:{_a:"F-6",_b:80},Fs6:{_a:"F#6",_b:75.5,_k:75},G6:{_a:"G-6",_b:71.25,_k:71},Gs6:{_a:"G#6",_b:67.25,_k:67},A6:{_a:"A-6",_b:63.5,_k:63},As6:{_a:"A#6",_b:60},B6:{_a:"B-6",_b:56.625,_k:56},C7:{_a:"C-7",_b:53.5,_k:53},Cs7:{_a:"C#7",_b:50.5,_k:50},D7:{_a:"D-7",_b:47.625,_k:47},Ds7:{_a:"D#7",_b:45},E7:{_a:"E-7",_b:42.375,_k:42},F7:{_a:"F-7",_b:40},Fs7:{_a:"F#7",_b:37.75,_k:37},G7:{_a:"G-7",_b:35.625,_k:35},Gs7:{_a:"G#7",_b:33.625,_k:33},A7:{_a:"A-7",_b:31.75,_k:31},As7:{_a:"A#7",_b:30},B7:{_a:"B-7",_b:28.3125,_k:28},C8:{_a:"C-8",_b:26.75},Cs8:{_a:"C#8",_b:25.25},D8:{_a:"D-8",_b:23.8125},Ds8:{_a:"D#8",_b:22.5},E8:{_a:"E-8",_b:21.1875},F8:{_a:"F-8",_b:20},Fs8:{_a:"F#8",_b:18.875},G8:{_a:"G-8",_b:17.8125},Gs8:{_a:"G#8",_b:16.8125},A8:{_a:"A-8",_b:15.875},As8:{_a:"A#8",_b:15},B8:{_a:"B-8",_b:14.15625},C9:{_a:"C-9",_b:13.375},Cs9:{_a:"C#9",_b:12.625},D9:{_a:"D-9",_b:11.90625},Ds9:{_a:"D#9",_b:11.25},E9:{_a:"E-9",_b:10.59375},F9:{_a:"F-9",_b:10},Fs9:{_a:"F#9",_b:9.4375},G9:{_a:"G-9",_b:8.90625},Gs9:{_a:"G#9",_b:8.40625},A9:{_a:"A-9",_b:7.9375},As9:{_a:"A#9",_b:7.5},B9:{_a:"B-9",_b:7.078125},C10:{_a:"C-10",_b:6.6875},Cs10:{_a:"C#10",_b:6.3125},D10:{_a:"D-10",_b:5.953125},Ds10:{_a:"D#10",_b:5.625},E10:{_a:"E-10",_b:5.296875},F10:{_a:"F-10",_b:5},Fs10:{_a:"F#10",_b:4.71875},G10:{_a:"G-10",_b:4.453125},Gs10:{_a:"G#10",_b:4.203125},A10:{_a:"A-10",_b:3.96875},As10:{_a:"A#10",_b:3.75},B10:{_a:"B-10",_b:3.5390625},C11:{_a:"C-11",_b:3.34375},Cs11:{_a:"C#11",_b:3.15625},D11:{_a:"D-11",_b:2.9765625},Ds11:{_a:"D#11",_b:2.8125},E11:{_a:"E-11",_b:2.6484375},F11:{_a:"F-11",_b:2.5},Fs11:{_a:"F#11",_b:2.359375},G11:{_a:"G-11",_b:2.2265625},Gs11:{_a:"G#11",_b:2.1015625},A11:{_a:"A-11",_b:1.984375},As11:{_a:"A#11",_b:1.875},B11:{_a:"B-11",_b:1.76953125},OFF:{_a:"OFF",_b:0}},me=145,ve=1,he=2,ge={unrollLoops:!1,unrollShortLoops:!1,sustainKeyboardNotes:!1,useHover:!0,keyboardTable:"qwerty",vubars:!0,stereoSeparation:p,_B:!0,loadInitialFile:!0},be=(o={},{on:function(e,t){var n=o[e];return n||(o[e]=n=[]),n.push(t),n.length},off:function(e,t){var n=o[e];n&&(n[t-1]=void 0)},_o:function(e,t){var n=o[e];if(n){var a,r=n.length;for(a=0;a<r;a++)n[a]&&n[a](t,e)}}}),ye=function(){var P,o,s,u,S,F={};window.AudioContext=window.AudioContext||window.webkitAudioContext,window.OfflineAudioContext=window.OfflineAudioContext||window.webkitOfflineAudioContext;var V,I,M=[],_=p,n=0,B=[[],[],[]],G=0,D=4143.569,l={volume:!0,panning:!0,high:!0,mid:!0,low:!0,lowPass:!0,reverb:!0,distortion:!1};return AudioContext&&(P=new AudioContext),F.init=function(e,t){function n(){var e=FilterChain(l);e.output().connect(u),M.push(e)}if(F.context=P=e=e||P,e){var a,r;V=!!ye.context.createStereoPanner,I="undefined"!=typeof Editor,r=t,(s=(a=e).createGain()).gain.setValueAtTime(1,0),s.connect(r||a.destination),(o=a.createGain()).connect(s),F.setMasterVolume(1),(u=a.createBiquadFilter()).type="lowpass",u.frequency.setValueAtTime(2e4,0),u.connect(o),F.masterVolume=o,F.cutOffVolume=s,F.lowPassfilter=u;var i=Pe.$b();for(M=[],S=0;S<i;S++)n();F.filterChains=M,F.usePanning=V,be.on(c,function(e){void 0!==e.track&&M[e.track]&&M[e.track].volumeValue(e.mute?0:70)}),be.on(ae,function(e){for(S=M.length;S<e;S++)n();be._o(f,e),F.setStereoSeparation(_)}),be.on(ie,function(e){F.setStereoSeparation()})}},F.enable=function(){s.gain.setValueAtTime(1,0),F.cutOff=!1},F.disable=function(){s.gain.setValueAtTime(0,0),F.cutOff=!0;B.forEach(function(e,t){e.forEach(function(e){e.gain.cancelScheduledValues(0),e.gain.setValueAtTime(0,0)}),B[t]=[]})},F.checkState=function(){P&&"suspended"===P.state&&P.resume&&P.resume()},F.playSample=function(e,t,n,a,r,i,o){var s;s=P,F.enable(),t=t||428,void 0===a&&(a=I?Editor.getCurrentTrack():0),i=i||P.currentTime,o===me&&(n=0);var u,_,l,c=Pe.getInstrument(e),f=t,p=0;if(c){var d,m,v=0,h=0;n=void 0===n?100*c.sample.volume/64:n,p=(c.sample.panning||0)/128,Pe._j()?Pe._s?t-=c._G()/2:c._G()&&(t=F._E(o,c._G())):c._G()&&(t=F._F(t,c._G())),m=F._P(t);var g=1;c.sample.data.length?(h=c.sample.data.length,r&&r.offset&&(h<=r.offset.value&&(r.offset.value=h-1),v=r.offset.value/s.sampleRate),d=s.createBuffer(1,h,s.sampleRate),g=m/s.sampleRate):(d=s.createBuffer(1,1,s.sampleRate),v=0);var b=d.getChannelData(0);for(S=0;S<h;S++)b[S]=c.sample.data[S];D=m;var y=s.createBufferSource();y.buffer=d;var T=s.createGain();if(T.gain.value=n/100,T.gain.setValueAtTime(n/100,i),c.sample.loop.enabled&&2<c.sample.loop.length&&(ge.unrollLoops||(y.loop=!0,y.loopStart=c.sample.loop.start/s.sampleRate,y.loopEnd=(c.sample.loop.start+c.sample.loop.length)/s.sampleRate)),c._c.enabled||c._d.enabled||c.hasVibrato()){var w=c.noteOn(i),k=y;w.volume&&(y.connect(u=w.volume),k=u),w.panning&&(k.connect(_=w.panning),k=_),l=w.scheduled,k.connect(T)}else y.connect(T);var x=ye.context.createGain();if(x.gain.setValueAtTime(0,i),x.gain.linearRampToValueAtTime(1,i+.01),T.connect(x),V){var C=ye.context.createStereoPanner();C.pan.setValueAtTime(p,i),x.connect(C),C.connect(M[a].input())}else x.connect(M[a].input());y.playbackRate.value=g;y.start(i+0,v);var A={source:y,volume:T,panning:C,_c:u,_d:_,_X:x,_Y:n,_V:n,_U:t,basePeriod:f,noteIndex:o,startPlaybackRate:g,sampleRate:m,_q:e,effects:r,track:a,time:i,scheduled:l};return B[G].push(T),be._o(E,A),A}return{}},F.playSilence=function(){if(P){var e=P.createBufferSource();e.connect(o);try{e.start()}catch(e){}}},F.playRaw=function(e,t){if(P&&e&&e.length){var n;n=P.createBuffer(1,e.length,P.sampleRate);var a=t/audioContext.sampleRate,r=P.createBufferSource();r.buffer=n,r.loop=!0,r.playbackRate.value=a,r.connect(o),r.start()}},F.setStereoSeparation=function(e){var t,n=Pe.$b();if(Pe._j())t=0;else switch(_=e=e||_){case d:t=0,ge.stereoSeparation=d;break;case r:t=1,ge.stereoSeparation=r;break;default:t=.5,ge.stereoSeparation=p}for(S=0;S<n;S++){var a=M[S];a&&a.panningValue(S%4==0||S%4==3?-t:t)}},F.getPrevSampleRate=function(){return D},F.context=P,F.getSemiToneFrom=function(e,t,n){var a=e;if(n&&(e=(e=F._GBasePeriod(e,n))||a),t){var r=Te[e];if(r){var i=xe.indexOf(r._a),o=xe[i+t];if(o){var s=ke[o];s&&(a=s._b,n&&(a=F._F(a,n)))}}}return a},F.getNearestSemiTone=function(e,t){var n=8;if(t){var a=Pe.getInstrument(t);a&&a.sample.finetune&&(n+=a.sample.finetune)}var r=1e5,i=e;for(var o in pe)if(pe.hasOwnProperty(o)){var s=pe[o].tune[n],u=Math.abs(s-e);u<r&&(r=u,i=s)}return i},F._F=function(e,t){var n=e,a=Te[e];if(a&&a.tune){var r=8+t;0<=r&&r<a.tune.length&&(n=a.tune[r])}return n},F._E=function(e,t){if(e===me)return 1;var n=Ce[e],a=0<t?Ce[e+1]:Ce[e-1];if(n&&a){var r=Math.abs(a._b-n._b)/127;return n._b-r*t}return n?n._b:1e5},F._GBasePeriod=function(e,t){var n=e,a=we[t];return a&&(n=a[e]),n},F._P=function(e){return Pe._j()?Pe._s?8363*Math.pow(2,(4608-e)/768):3579364/e:3546895/e},F.limitAmigaPeriod=function(e){return e=Math.max(e,113),e=Math.min(e,856)},F.setAmigaLowPassFilter=function(e,t){u.frequency.setValueAtTime(e?2e3:2e4,t)},F.setMasterVolume=function(e,t){e*=.7,o.gain.setValueAtTime(n,t=t||P.currentTime),o.gain.linearRampToValueAtTime(e,t+.02),n=e},F.slideMasterVolume=function(e,t){o.gain.linearRampToValueAtTime(e*=.7,t=t||P.currentTime),n=e},F.getLastMasterVolume=function(){return n/.7},F.clearScheduledNotesCache=function(){2<++G&&(G=0),B[G]=[]},F._r={sine:function(e,t,n,a){return e+Math.sin(t*n*.8)*a*1.7},saw:function(e,t,n,a){var r=1-Math.abs(t*n/7%1);return e+(r=(r=2*r-1)*a*-2)},square:function(e,t,n,a){var r=Math.sin(t*n)<=0?-1:1;return e+(r=r*a*2)},sawInverse:function(e,t,n,a){var r=Math.abs(t*n/7%1);return e+(r=(r=2*r-1)*a*-2)}},F}();!function(r,i,e){function o(n,e){if(!i[n]){if(!r[n]){var t="function"==typeof require&&require;if(!e&&t)return t(n,!0);if(s)return s(n,!0);throw new Error("Cannot find module '"+n+"'")}var a=i[n]={exports:{}};r[n][0].call(a.exports,function(e){var t=r[n][1][e];return o(t||e)},a,a.exports)}return i[n].exports}for(var s="function"==typeof require&&require,t=0;t<e.length;t++)o(e[t])}({1:[function(e,t,n){var a=e("./lib/WAAClock");t.exports=a,"undefined"!=typeof window&&(window.WAAClock=a)},{"./lib/WAAClock":2}],3:[function(e,t,n){var a=t.exports={};a.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(t){var n=[];return window.addEventListener("message",function(e){var t=e.source;t!==window&&null!==t||"process-tick"!==e.data||(e.stopPropagation(),0<n.length&&n.shift()())},!0),function(e){n.push(e),window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}(),a.title="browser",a.browser=!0,a.env={},a.argv=[],a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")}},{}],2:[function(e,t,n){var a=e("__browserify_process");if("undefined"!=typeof window&&!AudioContext)throw new Error("This browser doesn't seem to support web audio API");function r(e,t,n){this.clock=e,this.func=n,this.repeatTime=null,this._n=i,this._m=o,this._armed=!1,this._latestTime=null,this._earliestTime=null,this.schedule(t)}var i=.1,o=.001;r.prototype.clear=function(){return this.clock._removeEvent(this),this},r.prototype.repeat=function(e){if(0===e)throw new Error("delay cannot be 0");return this.repeatTime=e,this},r.prototype.tolerance=function(e){return"number"==typeof e.late&&(this._n=e.late),"number"==typeof e.early&&(this._m=e.early),this._update(),this},r.prototype.isRepeated=function(){return null!==this.repeatTime},r.prototype.schedule=function(e){this._armed=!0,this.deadline=e,this._update(),this._earliestTime<=this.clock.context.currentTime&&(this.clock._removeEvent(this),this._execute())},r.prototype._execute=function(){this._armed=!1,this.clock.context.currentTime<this._latestTime?this.func(this):be&&be._o(u),!1===this._armed&&this.isRepeated()&&this.schedule(this.deadline+this.repeatTime)},r.prototype._update=function(){this._latestTime=this.deadline+this._n,this._earliestTime=this.deadline-this._m,this.clock._removeEvent(this),this.clock._insertEvent(this)};var s=t.exports=function(e,t){this._m=(t=t||{})._m||o,this._n=t._n||i,this.context=e,this._events=[],this._started=!1};s.prototype.setTimeout=function(e,t){return this._createEvent(e,this._absTime(t))},s.prototype.callbackAtTime=function(e,t){return this._createEvent(e,t)},s.prototype.timeStretch=function(n,e,a){var r=this.context.currentTime;return e.forEach(function(e){e.isRepeated()&&e.repeat(e.repeatTime*a);var t=n+a*(e.deadline-n);if(e.isRepeated())for(;t-e._m<=r;)t+=e.repeatTime;e.schedule(t)}),e},s.prototype.start=function(){if(!1===this._started){var e=this;this._started=!0,this._events=[];this._clockNode=this.context.createScriptProcessor(256,1,1),this._clockNode.connect(this.context.destination),this._clockNode.onaudioprocess=function(){a.nextTick(function(){e._tick()})}}},s.prototype.stop=function(){!0===this._started&&(this._started=!1,this._clockNode.disconnect())},s.prototype._tick=function(){for(var e=this._events.shift();e&&e._earliestTime<=this.context.currentTime;)e._execute(),e=this._events.shift();e&&this._events.unshift(e)},s.prototype._createEvent=function(e,t){var n=new r(this,t,e);return n.tolerance({late:this._n,early:this._m}),n},s.prototype._insertEvent=function(e){this._events.splice(this._indexByTime(e._earliestTime),0,e)},s.prototype._removeEvent=function(e){var t=this._events.indexOf(e);-1!==t&&this._events.splice(t,1)},s.prototype._indexByTime=function(e){for(var t,n=0,a=this._events.length;n<a;)t=Math.floor((n+a)/2),this._events[t]._earliestTime<e?n=t+1:a=t;return n},s.prototype._absTime=function(e){return e+this.context.currentTime},s.prototype._relTime=function(e){return e-this.context.currentTime}},{__browserify_process:3}]},{},[1]),FilterChain=function(e){function n(){var e,t,n,a;if(o=i,h&&(_=_||((e=P.createBiquadFilter()).type="highshelf",e.frequency.value=3200,e.gain.value=C,e),o.connect(_),o=_),g&&(l=l||((t=P.createBiquadFilter()).type="peaking",t.frequency.value=1e3,t.Q.value=.5,t.gain.value=x,t),o.connect(l),o=l),b&&(c=c||((n=P.createBiquadFilter()).type="lowshelf",n.frequency.value=320,n.gain.value=k,n),o.connect(c),o=c),y&&(f=f||((a=P.createBiquadFilter()).type="lowpass",a.frequency.value=5e3,a),o.connect(f),o=f),T&&(p=p||P.createConvolver(),(d=d||P.createGain()).gain.value=0,o.connect(d),d.connect(p),s=p),w){var r=P.createWaveShaper();r.curve=function(e){for(var t,n="number"==typeof e?e:50,a=new Float32Array(44100),r=Math.PI/180,i=0;i<44100;++i)a[i]=(3+n)*(t=2*i/44100-1)*20*r/(Math.PI+n*Math.abs(t));return a}(400),r.oversample="4x"}v&&(m=m||ye.context.createStereoPanner(),o.connect(m),o=m),u=u||P.createGain(),o.connect(u),s&&s.connect(u),o=u}var t={};e=e||{volume:!0,panning:!0};var i,o,s,u,_,l,c,f,p,d,m,a=(e={volume:!0,panning:!0}).volume,v=e.panning&&ye.context.createStereoPanner,h=e.high,g=e.mid,b=e.low,y=e.lowPass,T=e.reverb,w=e.distortion,k=0,x=0,C=0,r=70,A=0,P=ye.context;return(i=P.createGain()).gain.value=1,o=i,t.lowValue=function(e){if(b){if(void 0!==e){c.gain.value=20*(k=e)}return k}},t.midValue=function(e){if(g){if(void 0!==e){l.gain.value=20*(x=e)}return x}},t.highValue=function(e){if(h){if(void 0!==e){_.gain.value=20*(C=e)}return C}},t.lowPassFrequencyValue=function(e){if(y){var t=ye.context.sampleRate/2,n=Math.log(t/40)/Math.LN2,a=Math.pow(2,n*(e-1));f.frequency.value=t*a}},t.lowPassQualityValue=function(e){y&&(f.Q.value=30*e)},t.reverbValue=function(e){if(T){if(!p.buffer){var t=S.audio["data/reverb/sportcentre.m4a"];if(t)p.buffer=t;else I().load(["data/reverb/sportcentre.m4a"],F,function(){p.buffer=S.audio["data/reverb/sportcentre.m4a"]})}var n=parseInt(e)/100;d.gain.value=n*n}},t.volumeValue=function(e){if(a){if(void 0!==e){var t=(r=e)/100;u.gain.value=t*t}return r}},t.panningValue=function(e,t){if(v)return void 0!==e&&m.pan.setValueAtTime(A=e,t||ye.context.currentTime),A},t.setState=function(e,t){i.disconnect(),_&&_.disconnect(),l&&l.disconnect(),c&&c.disconnect(),f&&f.disconnect(),d&&d.disconnect(),m&&m.disconnect(),s=void 0,"high"===e&&(h=!!t),"mid"===e&&(g=!!t),"low"===e&&(b=!!t),"lowPass"===e&&(y=!!t),"reverb"===e&&(T=!!t),"panning"===e&&(v=!!t&&ye.context.createStereoPanner),n()},t.input=function(){return i},t.output=function(){return o},n(),t.volumeValue(r),t};var a,_,l,Te={},we={},ke={},xe=[],Ce=[],Ae=[],Pe=function(){function e(u){u=u||0,(a=a||new WAAClock(ye.context)).start(),ye.enable(),G&&G.setStatus("Playing"),q=[],U=[];var _=(y=b.patterns[u]).length,l={},c=0,f=ye.context.currentTime+.1,p=.2,d=y,m=w;V=[],T=a.setTimeout(function(e){1<c&&T.repeat(p=1);var t=e.deadline+p;for(ye.clearScheduledNotesCache();f<t;){if(l.pause&&!Pe.autoPlay){if(!l.pasuseHandled){var n=f-ye.context.currentTime;0<n&&setTimeout(function(){j.pause(),j._x(6)},Math.round(1e3*n)+100),l.pasuseHandled=!0}return}if(j.setStateAtTime(f,{patternPos:c,songPos:m}),G||j.setCurrentSongPosition(m),l.patternDelay){for(l.patternDelay--,i=0;i<C;i++)h(i,f);f+=N*O}else if(l=v(c,f,d,m),f+=N*O,_<=++c||l._W){if(l.positionBreak&&l._A==m||(q=[],U=[]),c=0,Pe.getPlayType()==ce){var a=l.positionBreak?l._A:++m;b.length<=a&&(a=b._L?b._L-1:0,be._o(se)),b.length<=a&&(a=0),(d=b.patterns[u=b.patternTable[m=a]])||(d=g(),b.patterns[u]=d),_=d.length,l._W&&d.length<(c=l._y||0)&&(c=0)}else l._W&&P<(c=l._y||0)&&(c=0);be._o(ue,f-N*O)}}for(i=0;i<C;i++){var r=H[i];if(r&&r.time&&r.scheduled){var o=j.getInstrument(r._q);if(r.scheduled.volume&&r.scheduled.volume<=f+p){var s=o.scheduleEnvelopeLoop(r._c,r.scheduled.volume,2);r.scheduled.volume+=s}r.scheduled.panning&&r.scheduled.panning<=f+p&&(s=o.scheduleEnvelopeLoop(r._d,r.scheduled.panning,2),r.scheduled.panning+=s)}}},.01).repeat(p).tolerance({early:.1})}function v(e,t,n,a){for(var r,i=(n=n||y)[e],o=C,s={},u=0;u<o;u++)(_=i[u])&&_.effect&&15===_.effect&&(_._i<32?(Pe._x(_._i),0===_._i&&(s.pause=!0)):Pe.setBPM(_._i));for(u=0;u<o;u++){var _=i[u];if(_){var l={position:a,step:e},c=t;if(F)c+=(Math.random()*F*2-F)/1e3;(r=f(_,u,c,l))._W&&(s._W=!0,s._y=r._y||0),r.positionBreak&&(s.positionBreak=!0,s._y=r._y||0,s._A=r._A||0),r.patternDelay&&(s.patternDelay=r.patternDelay)}}for(u=0;u<o;u++)h(u,t);return s}function f(e,t,n,a){var r=100,i={},o=e._u,s=e._b,u=e.index;s&&!o&&(o=H[t]._Z,r="number"==typeof H[t]._V?H[t]._V:r,ge._B&&o&&L[t].offset&&L[t].offset._u===o&&(i.offset=L[t].offset)),"number"==typeof e._u&&(I=j.getInstrument(e._u))&&(r=I.sample.volume/64*100,ge._B&&(L[t].offset=L[t].offset||{},L[t].offset.value=0,L[t].offset._u=e._u));var _=r,l=!0;if("number"==typeof o&&(I=j.getInstrument(o)),u&&j._j())if(97===u&&(u=me),u===me){var c=I||j.getInstrument(H[t]._Z);r=_=c?c.noteOff(n,H[t]):0,l=!1}else if(I&&(I.setSampleForNoteIndex(u),I.sample.relativeNote&&(u+=I.sample.relativeNote)),j._s)s=7680-64*(u-1);else{var f=Ce[u];f&&(s=f._b)}var p,d,m=e._i,v={};if(e._T&&j._j()){var h=e._T;if(p=h>>4,d=15&h,15<h&&h<=80)i.volume={value:r=_=(h-16)/64*100};else switch(p){case 6:i.fade={value:-1*d*100/64};break;case 7:i.fade={value:100*d/64};break;case 8:i.fade={value:100*-d/64,fine:!0};break;case 9:i.fade={value:100*d/64,fine:!0};break;case 10:case 11:break;case 12:i.panning={value:17*(h-192),slide:!1};break;case 13:i.panning={value:h,slide:!0}}}switch(e.effect){case 0:if(m){p=m>>4,d=15&m;var g=0;if(I=I||j.getInstrument(H[t]._Z),j._j()){if(I){var b=u||H[t].noteIndex,y=I._O(b,!0);u===me?i.arpeggio=L[t].arpeggio:(i.arpeggio={root:y,interval1:y-I._O(b+p,!0),interval2:y-I._O(b+d,!0),step:1},L[t].arpeggio=i.arpeggio)}}else y=s||H[t]._U,I&&(g=I._G())&&(y=ye._F(y,g)),i.arpeggio={root:y,interval1:y-ye.getSemiToneFrom(y,p,g),interval2:y-ye.getSemiToneFrom(y,d,g),step:1}}e._u&&(i.volume={value:r});break;case 1:m*=-1,j._j()&&!m&&L[t].slideUp&&(m=L[t].slideUp.value),i.slide={value:m},L[t].slideUp=i.slide;break;case 2:j._j()&&!m&&L[t].slideDown&&(m=L[t].slideDown.value),i.slide={value:m},L[t].slideDown=i.slide;break;case 3:l=!1;var T=s;if(j._j()&&u===me&&(T=0),H[t]._Z&&(o=H[t]._Z),T&&o)(I=j.getInstrument(o))&&I._G()&&(T=j._j()?I._O(u,!0):ye._F(T,I._G()));(x=L[t].slide)&&(m=m||x.value),i.slide={value:m,target:T=T||L[t].$e,canUseGlissando:!0,resetVolume:!!e._u,volume:r},L[t].slide=i.slide,e._u&&(i.volume={value:r});break;case 4:e._u&&(H[t]._Y&&(i.volume={value:_}),H[t]._l=0);var w=(p=m>>4)*N/64,k=L[t]._p;0==p&&k&&(w=k.freq),0==(d=15&m)&&k&&(d=k.amplitude),i._p={amplitude:d,freq:w},L[t]._p=i._p;break;case 5:var x;l=!1,(T=s)&&o&&(I=j.getInstrument(o))&&I._G()&&(T=j._j()?ye._E(u,I._G()):ye._F(T,I._G())),m=1,(x=L[t].slide)&&(T=T||(x.target||0),m=x.value),i.slide={value:m,target:T},L[t].slide=i.slide,e._u&&(i.volume={value:r}),(m=e._i)&&(e._i<16?m*=-1:m=e._i>>4,i.fade={value:m=100*m/64,resetOnStep:!!e._u},L[t].fade=i.fade);break;case 6:e._u&&(H[t]._Y&&(i.volume={value:_}),H[t]._l=0),e._i?(e._i<16?m*=-1:m=15&e._i,i.fade={value:m=100*m/64},L[t].fade=i.fade):Pe._j()&&L[t].fade&&(i.fade=L[t].fade),L[t]._p&&(i._p=L[t]._p);break;case 7:s&&!e._u&&(H[t]._Y&&(i.volume={value:_}),H[t].tremoloTimer=0);var C=d=15&m,A=(w=(p=m>>4)*N/64,L[t].tremolo);0==p&&A&&(w=A.freq),0==d&&A&&(C=A.amplitude),i.tremolo={amplitude:C,freq:w},L[t].tremolo=i.tremolo;break;case 8:i.panning={value:m,slide:!1};break;case 9:!(m<<=8)&&L[t].offset&&(m=L[t].offset.stepValue||L[t].offset.value||0);var P=m;ge._B&&!e._u&&L[t].offset&&(m+=L[t].offset.value),i.offset={value:m,stepValue:P},L[t].offset=L[t].offset||{},L[t].offset.value=i.offset.value,L[t].offset.stepValue=i.offset.stepValue,ge._B&&(e._u&&(L[t].offset._u=e._u),s&&(L[t].offset.value+=P)),e._u&&(i.volume={value:r});break;case 10:if(e._i<16?m*=-1:m=e._i>>4,m=100*m/64,!e._i){var S=L[t].fade;S&&(m=S.value)}i.fade={value:m,resetOnStep:!!e._u},j._j()&&(L[t].fade=i.fade);break;case 11:Pe.autoPlay||(v._W=!0,v.positionBreak=!0,v._A=e._i,v._y=0);break;case 12:i.volume={value:_=e._i/64*100};break;case 13:v._W=!0,v._y=10*(p=m>>4)+(d=15&m);break;case 14:var F=m>>4,V=15&m;switch(F){case 0:j._j()||ye.setAmigaLowPassFilter(!V,n);break;case 1:!(V*=-1)&&L[t].fineSlide&&(V=L[t].fineSlide.value),i.slide={value:V,fine:!0},L[t].fineSlide=i.slide;break;case 2:!V&&L[t].fineSlide&&(V=L[t].fineSlide.value),i.slide={value:V,fine:!0},L[t].fineSlide=i.slide;break;case 3:L[t].glissando=!!V;break;case 4:switch(V){case 1:E=ye._r.saw;break;case 2:E=ye._r.square;break;case 3:case 4:E=ye._r.sine;break;case 5:E=ye._r.saw;break;case 6:E=ye._r.square;break;case 7:default:E=ye._r.sine}break;case 5:if(o){var I=j.getInstrument(o);i.fineTune={original:I._G(),_u:I},I.setFineTune(V)}break;case 6:V?(U[t]=U[t]||0,U[t]<V?(U[t]++,v._W=!0,v.positionBreak=!0,v._A=a.position,v._y=q[t]||0):U[t]=0):q[t]=a.step;break;case 7:switch(V){case 1:R=ye._r.saw;break;case 2:R=ye._r.square;break;case 3:case 4:R=ye._r.sine;break;case 5:R=ye._r.saw;break;case 6:R=ye._r.square;break;case 7:default:R=ye._r.sine}break;case 8:break;case 9:V&&(i.reTrigger={value:V});break;case 10:i.fade={value:V=100*V/64,fine:!0};break;case 11:i.fade={value:-(V=100*V/64),fine:!0};break;case 12:V?V<N&&(i.cutNote={value:V}):l=!1;break;case 13:V&&(V<N?n+=O*V:l=!1);break;case 14:v.patternDelay=V}break;case 15:break;case 16:m=Math.min(m,64),j.isPlugin||ye.setMasterVolume(m/64,n);break;case 17:p=m>>4,d=15&m;var M=64*ye.getLastMasterVolume(),B=0;if(p){var G=n+p*O;B=p*(N-1)}else d&&(G=n+d*O,B=-d*(N-1));B&&(m=(M+B)/64,m=Math.max(0,m),m=Math.min(1,m),ye.slideMasterVolume(m,G));break;case 20:j._j()&&(c=I||j.getInstrument(H[t]._Z),e._i&&N<=e._i||(l=!1,c?e._i?(i.noteOff={value:e._i},l=!0):r=_=c.noteOff(n,H[t]):r=0));break;case 21:case 25:break;case 27:i.reTrigger={value:e._i}}return l&&o&&s&&(D(t,n),H[t]={},I&&(H[t]=I.play(u,s,_,t,i,n)),L[t].$e=H[t]._U),o&&(H[t]._Z=o,i.fineTune&&i.fineTune._u&&i.fineTune._u.setFineTune(i.fineTune.original||0)),I&&I.hasVibrato()&&(H[t]._Q=!0),H[t].effects=i,H[t].note=e,v}function D(e,t){try{if(H[e].source){var n=H[e].volume.gain;n.setValueAtTime(H[e]._V/100,t-.002),n.linearRampToValueAtTime(0,t),H[e].source.stop(t+.02)}}catch(e){}}function A(e,t){var n=j.getInstrument(e._q);if(n){var a=-n._p.rate/40,r=n._p.depth/8;if(j._s&&(r*=4),e._l=e._l||0,n._p.sweep&&e._l<n._p.sweep)r*=1-(n._p.sweep-e._l)/n._p.sweep;var i=n._D()(t,e._l,a,r);return e._l++,i}return t}function h(e,t){var n=H[e],a=n.effects;if(n&&a){var r,i=!1;if(n.startVibratoTimer=n._l||0,n.$g&&n.source)j.$d(n,c=n.currentPeriod||n._U,t),n.$g=!1;if(a.volume){var o=a.volume.value;n.volume&&n.volume.gain.setValueAtTime(o/100,t),n._V=o}if(a.panning&&(255===(r=a.panning.value)&&(r=254),n.panning&&n.panning.pan.setValueAtTime((r-127)/127,t)),a.fade){var s;r=a.fade.value;var u=1;s=a.fade.resetOnStep?n._Y:n._V;var _=N;a.fade.fine&&(u=0,_=1);for(var l=u;l<_;l++)n.volume&&(n.volume.gain.setValueAtTime(s/100,t+l*O),s+=r,s=Math.max(s,0),s=Math.min(s,100));n._V=s}if(a.slide&&n.source){var c=m=n.currentPeriod||n._U;_=N;a.slide.fine&&(_=2);var f,p=a.slide.value;if(j._j()&&j._s&&(p=4*a.slide.value),r=Math.abs(p),j._j()&&a.slide.resetVolume&&(n._X||n._c))(f=j.getInstrument(n._q))&&f.resetVolume(t,n);n._l=n.startVibratoTimer;for(l=1;l<_;l++){a.slide.target?(L[e].$e=a.slide.target,c<a.slide.target?a.slide.target<(c+=r)&&(c=a.slide.target):(c-=r)<a.slide.target&&(c=a.slide.target)):(c+=p,L[e].$e&&(L[e].$e+=p)),j._j()||(c=ye.limitAmigaPeriod(c));var d=c;a.slide.canUseGlissando&&L[e].glissando&&(d=ye.getNearestSemiTone(c,n._q)),d!==n.currentPeriod&&(n.currentPeriod=c,n._Q&&j._j()&&(c=A(n,c),i=!0),j.$d(n,d,t+l*O))}}if(a.arpeggio&&n.source){var m=n.currentPeriod||n._U;n.$g=!0,n._l=n.startVibratoTimer;for(l=0;l<N;l++){var v=l%3;0==v&&(c=m),1==v&&a.arpeggio.interval1&&(c=m-a.arpeggio.interval1),2==v&&a.arpeggio.interval2&&(c=m-a.arpeggio.interval2),n._Q&&j._j()&&(c=A(n,c),i=!0),j.$d(n,c,t+l*O)}}if(a._p||n._Q&&!i){a._p=a._p||{freq:0,amplitude:0};var h=a._p.freq,g=a._p.amplitude;if(j._j()&&j._s&&(g*=4),n._l=n._l||0,n.source){n.$g=!0,m=n.currentPeriod||n._U,n._l=n.startVibratoTimer;for(l=0;l<N;l++)c=E(m,n._l,h,g),n._Q&&j._j()?(c=A(n,c),i=!0):n._l++,j.$d(n,c,t+l*O)}}if(a.tremolo){h=a.tremolo.freq,g=a.tremolo.amplitude;if(n.tremoloTimer=n.tremoloTimer||0,n.volume){var b=n._Y;for(l=0;l<N;l++)(b=R(b,n.tremoloTimer,h,g))<0&&(b=0),100<b&&(b=100),n.volume.gain.setValueAtTime(b/100,t+l*O),n._V=b,n.tremoloTimer++}}if(a.cutNote&&(n.volume&&n.volume.gain.setValueAtTime(0,t+a.cutNote.value*O),n._V=0),a.noteOff)(f=j.getInstrument(n._q))&&(n._V=f.noteOff(t+a.noteOff.value*O,n));if(a.reTrigger){var y=n._q,T=n._U;o=n._Y;for(var w=n.noteIndex,k=a.reTrigger.value||1,x=k;x<N;){var C=t+x*O;D(e,C),H[e]=ye.playSample(y,T,o,e,a,C,w),x+=k}}}}function s(){G&&G.setInfo(b.title),b.channels&&j.setTrackCount(b.channels),k=n=r=t=void 0,j.setCurrentSongPosition(0),j._C(0),j._S(1),j.clearEffectCache(),be._o(re,b),be._o(te,b)}function u(){be._o(le,0),be._o(_e,0),j._x(6),j.setBPM(125),R=E=ye._r.sine,L=[],H=[];for(var e=0;e<C;e++)H.push({}),L.push({});j._s=!1,j._R(ve,!0),j.isPlugin||ye.setMasterVolume(1),ye.setAmigaLowPassFilter(!1,0),"undefined"!=typeof StateManager&&StateManager.clear()}function g(){for(var e=[],t=0;t<P;t++){var n,a=[];for(n=0;n<C;n++)a.push(Ve());e.push(a)}return e}var a,b,r,n,t,y,E,R,T,j={},o=!(j.isMaster=!0),_=!1,l=[],c=1,p=0,d=0,m=ce,w=0,k=0,x=125,N=6,O=2.5/x,C=4,P=64,S=ve,F=0,H=[],L=[],V=[],q=[],U=[];j.init=function(t){for(var e=0;e<C;e++)H.push({}),L.push({});for(e=-8;e<8;e++)we[e]={};for(var n in pe)if(pe.hasOwnProperty(n)){var a=pe[n];if(xe.push((ke[(Te[a._b]=a)._a]=a)._a),a.tune)for(e=-8;e<8;e++){we[e][a.tune[e+8]]=a._b}}var r=0;for(n in de)if(de.hasOwnProperty(n)){var i=de[n];i._b||(i._b=1),Ce.push(i),Ae[i._b]=r,i._k&&(Ae[i._k]=r),r++}t&&(B.init(),ye.init(t.audioContext,t.audioDestination),t.plugin&&(j.isPlugin=!0,G.initPlugin(t),"boolean"==typeof t.isMaster&&(j.isMaster=t.isMaster),t.handler&&(be.on(ee,function(e){t.handler(ee,e)}),be.on(le,function(e){t.handler(le,e)}),be.on(Y,function(e){t.handler(Y,e)}),be.on(_e,function(e){t.handler(_e,e)}),be.on(ue,function(e){t.handler(ue,e)}))))},j.setMaster=function(e){j.isMaster=e},j.isMaster=function(){return!!j.isMaster},j._S=function(e){if(b._us[e])r!=(c=e)&&be._o($,c),r=c;else if(e<=j.getMaxInstruments()){for(var t=b._us.length,n=e;t<=n;t++)j.setInstrument(t,Fe());var a=[];for(t=1;t<=n;t++){a.push({label:t+" "+(b._us[t]||{_a:""})._a,data:t}),be._o(oe,a)}r!=(c=e)&&be._o($,c),r=c}},j.getCurrentInstrumentIndex=function(){return c},j.getCurrentInstrument=function(){return l[c]},j.getMaxInstruments=function(){return j._j()?128:31},j.setCurrentPattern=function(e){(y=b.patterns[p=e])||(y=g(),b.patterns[p]=y),P=y.length,n!=p&&be._o(W,p),n=p},j.getCurrentPattern=function(){return p},j.getCurrentPatternData=function(){return y},j.updatePatternTable=function(e,t){be._o(X,b.patternTable[e]=t),e==w&&(n=void 0,Pe.setCurrentPattern(t))},j._C=function(e){t!=(d=e)&&be._o(z,{current:d,prev:t}),t=d},j.getCurrentPatternPos=function(){return d},j.moveCurrentPatternPos=function(e){var t=d+e,n=P-1;t<0&&(t=n),n<t&&(t=0),j._C(t)},j.getCurrentSongPosition=function(){return w},j.setCurrentSongPosition=function(e,t){(w=e)!=k&&(be._o(Q,w),b.patternTable&&j.setCurrentPattern(b.patternTable[w]),k=w,t&&j.isPlaying()&&(j.stop(),j.togglePlay()))},j.setPlayType=function(e){be._o(J,m=e)},j.getPlayType=function(){return m},j.playSong=function(){j.stop(),ye.checkState(),j.setPlayType(ce),_=!0,e(p),be._o(Z,_)},j.playPattern=function(){j.stop(),ye.checkState(),d=0,j.setPlayType(fe),_=!0,e(p),be._o(Z,_)},j.stop=function(){a&&a.stop(),ye.disable(),j.isPlugin||ye.setMasterVolume(1),G&&(G.setStatus("Ready"),Input.clearInputNotes()),j.clearEffectCache();for(var e=0;e<C;e++)if(H[e].source)try{H[e].source.stop()}catch(e){}be._o(Z,_=!1)},j.pause=function(){a&&a.stop(),be._o(Z,_=!1)},j.togglePlay=function(){j.isPlaying()?j.stop():m==fe?j.playPattern():j.playSong()},j.getProperties=function(){return{ticksPerStep:N,tickTime:O}},j.playPatternStep=v,j.cutNote=D,j.setBPM=function(e,t){var n=t&&t.isMaster;j.isMaster||n?(a&&a.timeStretch(ye.context.currentTime,[T],x/e),n||be._o(le,x),O=2.5/(x=e),be._o(ee,x)):be._o(le,e)},j.getBPM=function(){return x},j._x=function(e,t){j.isMaster||t&&t.isMaster?be._o(Y,N=e):be._o(_e,e)},j.getAmigaSpeed=function(){return N},j.getSwing=function(){return F},j.setSwing=function(e){F=e},j.getPatternLength=function(){return P},j.setPatternLength=function(e){var t=b.patterns[p].length;if(t!==(P=e)){if(t<P)for(var n=t;n<P;n++){var a,r=[];for(a=0;a<C;a++)r.push(Ve());b.patterns[p].push(r)}else b.patterns[p]=b.patterns[p].splice(0,P),P<=d&&j._C(P-1);be._o(W,p)}},j.$b=function(){return C},j.setTrackCount=function(e){C=e;for(var t=H.length;t<C;t++)H.push({});for(t=L.length;t<C;t++)L.push({});be._o(ae,C)},j.toggleRecord=function(){j.stop(),be._o(K,o=!o)},j.isPlaying=function(){return _},j.isRecording=function(){return o},j.setStateAtTime=function(e,t){V.push({time:e,state:t})},j.getStateAtTime=function(e){for(var t=void 0,n=0,a=V.length;n<a;n++){if(!(V[0].time<e))return t;t=V.shift().state}return t},j.getTimeStates=function(){return V},j.$d=function(e,t,n){if(t=Math.max(t,1),j._j()&&j._s)var a=8363*Math.pow(2,(4608-t)/768)/ye.context.sampleRate;else a=e._U/t,a*=e.startPlaybackRate;e.source.playbackRate.setValueAtTime(a,n),e.source.playbackRate.setValueAtTime(a,n+.005)},j.load=function(o,s,u,t){(o=o||"demomods/StardustMemories.mod").indexOf("://")<0&&0!==o.indexOf("/")&&(o=B.getBaseUrl()+o),G&&(G.setInfo(""),G.setLoading());function n(e){t&&!B.useInitialLoad||j.processFile(e,_,function(e){if(G&&G.setStatus("Ready"),e){var t="",n="";if("string"==typeof o){if(0<o.indexOf("modarchive.org")){var a=o.split("moduleid=")[1];b.file_a=a.split("#")[1]||a,n="modArchive",t="https://modarchive.org/index.php?request=view_by_moduleid&query="+(a=(a=a.split("#")[0]).split("&")[0]),be._o(te,b)}0<o.indexOf("modules.pl")&&(a=o.split("modules.pl/")[1],b.file_a=a.split("#")[1]||a,n="modules.pl",t="http://www.modules.pl/?id=module&mod="+(a=(a=a.split("#")[0]).split("&")[0]),be._o(te,b))}G&&G.setInfo(b.title,n,t)}if(G&&e&&!s){var r=window.location.path_a,i=r.substring(r.lastIndexOf("/")+1);window.history.pushState&&window.history.pushState({},_,i+"?file="+encodeURIComponent(o))}e&&I(s),u&&u()})}var e,a,r,_="";"string"==typeof o?(_=o.substr(o.lastIndexOf("/")+1),e=o,a=function(e){n(e)},(r=new XMLHttpRequest).open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(e){var t=r.response;t&&200===r.status?a&&a(t):"undefined"!=typeof Editor&&a&&a(!1)},r.send(null)):(_=o._a||"",s=!0,n(o.buffer||o))};var I=function(e){var t=function(e){if(window.location.getParameter)return window.location.getParameter(e);if(location.search)for(var t=location.search.substring(1).split("&"),n=0;n<t.length;n++){var a=t[n].split("=");if(a[0]&&a[0]==e)return a[1]||!0}}("autoplay");Pe.autoPlay&&(t="1"),!G&&e&&(t="1"),"true"!=t&&"1"!=t||Pe.playSong()};return j.handleUpload=function(e){if(e.length){var t=e[0],n=new FileReader;n.onload=function(){j.processFile(n.result,t._a,function(e){G&&G.setStatus("Ready")})},n.readAsArrayBuffer(t)}},j.processFile=function(e,a,r){var t=!1,n=new M(e,!0),i=Se.detect(n,a);if(i&&"ZIP"==i._a)if(G&&G.setStatus("Extracting Zip file",!0),"undefined"!=typeof UZIP){var o=UZIP.parse(e);for(var a in o){j.processFile(o[a].buffer,a,r);break}}else zip.workerScriptsPath="script/src/lib/zip/",zip.useWebWorkers=B.useWebWorkers,zip.createReader(new zip.ArrayBufferReader(e),function(e){var t,n=0;e.getEntries(function(e){e&&e.length&&e.forEach(function(e){n<e.uncompressedSize&&(n=e.uncompressedSize,t=e)}),t?t.getData(new zip.ArrayBufferWriter,function(e){e&&e.byteLength&&j.processFile(e,a,r)}):r&&r(!1)})},function(e){r&&r(!1)});i.isMod&&i.loader&&(t=!0,j.isPlaying()&&j.stop(),u(),(b=i.loader().load(n,a)).file_a=a,s()),i.isSample&&"undefined"!=typeof Editor&&Editor.importSample(n,a),r&&r(t)},j.getSong=function(){return b},j.getInstruments=function(){return l},j.getInstrument=function(e){return l[e]},j.setInstrument=function(e,t){l[t._q=e]=t},j.clearEffectCache=function(){L=[];for(var e=0;e<C;e++)L.push({})},j.$a=function(e){if(b){var t=[],n=e||b._us.length-1;for(l=[],i=1;i<=n;i++)j.setInstrument(i,Fe()),t.push({label:i+" ",data:i});b._us=l,be._o(oe,t),be._o($,c)}},j._R=function(e,t){function n(){S=e,ge._B=!j._j(),be._o(ie,e)}e===ve&&!t&&32<Pe.getInstruments().length?G.showDialog("WARNING !!!//This file has more than 31 _us./If you save this file as .MOD, only the first 31 _us will be included.//Are you sure you want to continue?",function(){n()},function(){}):n()},j.getTrackerMode=function(){return S},j._j=function(){return S===he},j.new=function(){u(),b={patterns:[],_us:[]},j.$a(31),b.typeId="M.K.",b.title="new song",b.length=1,b._L=0,b.patterns.push(g());for(var e=[],t=0;t<128;++t)e[t]=0;b.patternTable=e,s()},j.clearInstrument=function(){l[c]=Fe(),be._o($,c),be._o(ne,c)},j.getFileName=function(){return b.file_a||(b.title?b.title.replace(/ /g,"-").replace(/\W/g,"")+".mod":"new.mod")},j._s=!0,j}(),I=function(){var i={load:function(e,t,n){i.type=t||s,i.loadCount=0,i.max=e.length,i.next=n;for(var a=0,r=e.length;a<r;a++)o(e[a])}},o=function(t){if(i.type==s){var e=new Image;e.onload=function(){S.images[t]=this,++i.loadCount==i.max&&i.next&&i.next()},e.onerror=function(){alert("BufferLoader: XHR error")},e.src=t}if(i.type==F){var n=new XMLHttpRequest;n.responseType="arraybuffer",n.open("GET",t,!0),n.onload=function(){ye.context.decodeAudioData(n.response,function(e){e?(S.audio[t]=e,++i.loadCount==i.max&&i.next&&i.next()):alert("error decoding file data: "+t)},function(e){})},n.onerror=function(){alert("BufferLoader: XHR error")},n.send()}};return i},Se=((a={}).get=function(e,t){a.ajax({url:e,success:function(e){t(e)},error:function(e){t(void 0,e)}})},a.json=function(e,t){void 0===t&&(t=function(){}),a.ajax({url:e,cache:!1,datatype:"json",headers:[{key:"Accept",value:"application/json"}],success:function(e){t(e)},error:function(e){t(void 0,e)}})},a.html=function(e,t){a.ajax({url:e,cache:!1,datatype:"html",success:function(e){t(e)},error:function(e){t(void 0,e)}})},a.ajax=function(t){var n=new XMLHttpRequest;t.error=t.error||function(){t.success(!1)},"jsonp"===t.datatype&&t.error(n);var e=t.url;if("boolean"==typeof t.cache&&!t.cache&&B.$f){var a=(new Date).getTime();e+=0<e.indexOf("?")?"&r="+a:"?r="+a}var r=t.method||"GET";n.onreadystatechange=function(){if(!(n.readyState<4)&&4===n.readyState)if(200!==n.status&&201!==n.status)t.error(n);else{var e=n.responseText;"json"===t.datatype&&(e=JSON.parse(e)),"html"===t.datatype&&((e=document.createElement("div")).innerHTML=n.responseText),t.success(e)}},n.ontimeout=function(e){},n.open(r,e,!0),n.timeout=t.timeout||3e4,t.headers&&t.headers.forEach(function(e){n.setRequestHeader(e.key,e.value)});var i=t.data||"";"POST"===r&&t.data&&"form"===t.datatype&&n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send(i)},l={unknown:{_a:"UNKNOWN"},unsupported:{_a:"UNSUPPORTED"},mod_ProTracker:{_a:"PROTRACKER",isMod:!0,loader:function(){return m()}},mod_SoundTracker:{_a:"SOUNDTRACKER",isMod:!0,loader:function(){return v()}},mod_FastTracker:{_a:"FASTTRACKER",isMod:!0,loader:function(){return h()}},sample:{_a:"SAMPLE",isSample:!0},zip:{_a:"ZIP"}},(_={}).detect=function(r,e){function i(e){return e<128}var o=r.length,t="";if("Extended Module: "==(t=r._v(17,0)))return l.mod_FastTracker;if(1100<o&&(t=r._v(4,1080)),"M.K."==t)return l.mod_ProTracker;if("M!K!"==t)return l.mod_ProTracker;if("M&K!"==t)return l.mod_ProTracker;if("FLT4"==t)return l.mod_ProTracker;if("2CHN"==t)return l.mod_ProTracker;if("6CHN"==t)return l.mod_ProTracker;if("8CHN"==t)return l.mod_ProTracker;if("10CH"==t)return l.mod_ProTracker;if("12CH"==t)return l.mod_ProTracker;if("14CH"==t)return l.mod_ProTracker;if("16CH"==t)return l.mod_ProTracker;if("18CH"==t)return l.mod_ProTracker;if("20CH"==t)return l.mod_ProTracker;if("22CH"==t)return l.mod_ProTracker;if("24CH"==t)return l.mod_ProTracker;if("26CH"==t)return l.mod_ProTracker;if("28CH"==t)return l.mod_ProTracker;if("30CH"==t)return l.mod_ProTracker;if("32CH"==t)return l.mod_ProTracker;var n="";return e&&4<e.length&&(n=e.substr(e.length-4)),".wav"==(n=n.toLowerCase())||".mp3"==n||".iff"==n?l.sample:".zip"==n||"PK"==r._v(2,0)?l.zip:e&&0<=e.indexOf(".")&&1624<o&&function(){r.goto(0);for(var e=0;e<20;e++)if(!i(r.readByte()))return;for(var t=0,n=0,a=0;a<15;a++){for(e=0;e<22;e++)if(!i(r.readByte()))return;if(r.jump(-22),"st-"==r._v(22).toLowerCase().substr(0,3)&&(n+=10),20<n)return 1;t+=r._g(),r.jump(6)}return!(o<2*t+1624)}()?l.mod_SoundTracker:l.sample},_),m=function(){var e={load:function(e,t){Pe._R(ve,!0),Pe._s=!1,Pe.$a(31);var n={patterns:[],_L:1},a=4;n.typeId=e._v(4,1080),n.title=e._v(20,0),"2CHN"===n.typeId&&(a=2),"6CHN"===n.typeId&&(a=6),"8CHN"===n.typeId&&(a=8),"10CH"===n.typeId&&(a=10),"12CH"===n.typeId&&(a=12),"14CH"===n.typeId&&(a=14),"16CH"===n.typeId&&(a=16),"18CH"===n.typeId&&(a=18),"20CH"===n.typeId&&(a=20),"22CH"===n.typeId&&(a=22),"24CH"===n.typeId&&(a=24),"26CH"===n.typeId&&(a=26),"28CH"===n.typeId&&(a=28),"30CH"===n.typeId&&(a=30),"32CH"===n.typeId&&(a=32),n.channels=a;var r=0;for(c=1;c<=31;++c){var i=e._v(22),o=e._g(),s=Fe();s._a=i,s.sample.length=s.sample.realLen=o<<1;var u=e._e();16<u&&(u%=16),7<u&&(u-=16),s.setFineTune(u),s.sample.volume=e._e(),s.sample.loop.start=e._g()<<1,s.sample.loop.length=e._g()<<1,s.sample.loop.enabled=2<s.sample.loop.length,s.sample.loop.type=P,s.pointer=r,r+=s.sample.length,s.setSampleIndex(0),Pe.setInstrument(c,s)}n._us=Pe.getInstruments(),e.goto(950),n.length=e._e(),e.jump(1);for(var _=[],l=0,c=0;c<128;++c)_[c]=e._e(),l<_[c]&&(l=_[c]);for(n.patternTable=_,e.goto(1084),c=0;c<=l;++c){for(var f=[],p=0;p<64;p++){var d,m=[];for(d=0;d<a;d++){var v=Ve(),h=e.readUint();v.setPeriod(h>>16&4095),v.effect=h>>8&15,v._u=h>>24&240|h>>12&15,v._i=255&h,m.push(v)}for(d=a;d<Pe.$b();d++)m.push(Ve());f.push(m)}n.patterns.push(f)}var g=[];for(c=1;c<=31;c++)if(s=Pe.getInstrument(c)){var b=s.sample.length;for(2<s.sample.loop.length&&ge.unrollShortLoops&&s.sample.loop.length<1e3&&(b=Math.min(b,s.sample.loop.start+s.sample.loop.length),s.sample.length=b),j=0;j<b;j++){var y=e.readByte();j<2&&(y=0),s.sample.data.push(y/127)}if((ge.unrollShortLoops||ge.unrollLoops)&&2<s.sample.loop.length){var T=Math.ceil(4e4/s.sample.loop.length)+1;ge.unrollLoops||(T=0);var w=!1,k=0;ge.unrollShortLoops&&s.sample.loop.length<1600&&(T=Math.floor(1e3/s.sample.loop.length),w=!0);for(var x=0;x<T;x++){var C=s.sample.loop.start,A=C+s.sample.loop.length;for(j=C;j<A;j++)s.sample.data.push(s.sample.data[j]);k+=s.sample.loop.length}w&&k&&(s.sample.loop.length+=k,s.sample.length+=k)}g.push({label:c+" "+s._a,data:c})}return be._o(oe,g),n}};return e},v=function(){var e={load:function(e,t){Pe._R(ve,!0),Pe._s=!1,Pe.$a(15);var n={patterns:[],_L:1};n.typeId="ST",n.channels=4,n.title=e._v(20,0);var a=0;for(_=1;_<=15;++_){var r=e._v(22),i=e._g(),o=Fe();o._a=r,o.sample.length=o.realLen=i<<1,o.sample.volume=e._g(),o.setFineTune(0),o.sample.loop.start=e._g(),o.sample.loop.length=e._g()<<1,o.sample.loop.enabled=2<o.sample.loop.length,o.sample.loop.type=P,o.pointer=a,a+=o.sample.length,o.setSampleIndex(0),Pe.setInstrument(_,o)}n._us=Pe.getInstruments(),e.goto(470),n.length=e._e(),n.speed=e._e();for(var s=[],u=0,_=0;_<128;++_)s[_]=e._e(),u<s[_]&&(u=s[_]);for(n.patternTable=s,e.goto(600),_=0;_<=u;++_){for(var l=[],c=0;c<64;c++){var f,p=[];for(f=0;f<4;f++){var d={},m=e.readUint();d._b=m>>16&4095,d.effect=m>>8&15,d._u=m>>24&240|m>>12&15,d._i=255&m,p.push(d)}for(f=4;f<Pe.$b();f++)p.push({note:0,effect:0,_u:0,_i:0});l.push(p)}n.patterns.push(l)}var v=[];for(_=1;_<=15;_++)if(o=Pe.getInstrument(_)){var h=o.sample.length;for(j=0;j<h;j++){var g=e.readByte();j<2&&(g=0),o.sample.data.push(g/127)}v.push({label:_+" "+o._a,data:_})}return be._o(oe,v),n}};return e},h=function(){var A={load:function(e,t){function n(e){for(e.points=[],g=0;g<12;g++)e.points.push(e.raw.slice(2*g,2*g+2));return 1&e.type&&(e.enabled=!0),2&e.type&&(e.sustain=!0),4&e.type&&(e.loop=!0),e}Pe._R(he,!0),Pe.$a(1);var a={},r={patterns:[],_us:[]};e._N=!0,e.goto(17),r.title=e._v(20),e.jump(1),a.trackerName=e._v(20),a.trackerVersion=e.readByte(),a.trackerVersion=e.readByte()+"."+a.trackerVersion,a.headerSize=e.$c(),a.songlength=e._g(),a._L=e._g(),a.numberOfChannels=e._g(),a.numberOfPatterns=e._g(),a.numberOfInstruments=e._g(),a.flags=e._g(),Pe._s=a.flags%2==1,a.defaultTempo=e._g(),a.defaultBPM=e._g();for(var i=[],o=0,s=0;s<a.songlength;++s)i[s]=e._e(),o<i[s]&&(o=i[s]);r.patternTable=i,r.length=a.songlength,r.channels=a.numberOfChannels,r._L=a._L+1;var u=60+a.headerSize;for(e.goto(u),s=0;s<a.numberOfPatterns;s++){var _=[],l={};l.headerSize=e.$c(),l.packingType=e._e(),l.patternLength=e._g(),l.patternSize=e._g(),e.goto(u+=l.headerSize);for(var c=0;c<l.patternLength;c++){var f,p=[];for(f=0;f<a.numberOfChannels;f++){var d=Ve(),m=e._e();128&m?(1&m&&d.setIndex(e._e()),2&m&&(d._u=e._e()),4&m&&(d._T=e._e()),8&m&&(d.effect=e._e()),16&m&&(d._i=e._e())):(d.setIndex(m),d._u=e._e(),d._T=e._e(),d.effect=e._e(),d._i=e._e()),p.push(d)}_.push(p)}e.goto(u+=l.patternSize),r.patterns.push(_)}var v=[];for(s=1;s<=a.numberOfInstruments;++s){var h=Fe();try{if(h.filePosition=e.index,h.headerSize=e.$c(),h._a=e._v(22),h.type=e._e(),h._K=e._g(),h.samples=[],(h._M=0)<h._K){h._M=e.$c(),h._M=Math.max(h._M,40),200<h._M&&(h._M=40);for(var g=0;g<96;g++)h._z.push(e._e());for(g=0;g<24;g++)h._c.raw.push(e._g());for(g=0;g<24;g++)h._d.raw.push(e._g());h._c.count=e._e(),h._d.count=e._e(),h._c._H=e._e(),h._c._w=e._e(),h._c._J=e._e(),h._d._H=e._e(),h._d._w=e._e(),h._d._J=e._e(),h._c.type=e._e(),h._d.type=e._e(),h._p.type=e._e(),h._p.sweep=e._e(),h._p.depth=Math.min(e._e(),15),h._p.rate=e._e(),h.fadeout=e._g(),h.reserved=e._g(),h._c=n(h._c),h._d=n(h._d)}}catch(e){}if(e.goto(u+=h.headerSize),0===h._K){var b=D();h.samples.push(b)}else{if(e.isEOF(1))break;for(var y=0;y<h._K;y++)(b=D()).length=e.$c(),b.loop.start=e.$c(),b.loop.length=e.$c(),b.volume=e._e(),b.finetuneX=e.readByte(),b.type=e._e(),b.panning=e._e()-128,b.relativeNote=e.readByte(),b.reserved=e.readByte(),b._a=e._v(22),b.bits=8,h.samples.push(b),e.goto(u+=h._M);for(y=0;y<h._K;y++)if((b=h.samples[y]).length){u+=b.length,16&b.type&&(b.bits=16,b.type^=16,b.length>>=1,b.loop.start>>=1,b.loop.length>>=1),b.loop.type=b.type||0,b.loop.enabled=!!b.loop.type;var T=b.length,w=0;if(16===b.bits)for(var k=0;k<T;k++){var x=e.readShort()+w;x<-32768?x+=65536:32767<x&&(x-=65536),b.data.push((w=x)/32768)}else for(k=0;k<T;k++)(x=e.readByte()+w)<-128?x+=256:127<x&&(x-=256),b.data.push((w=x)/127);if(b.loop.type===V){var C=b.data.slice(b.loop.start,b.loop.start+b.loop.length);b.data=b.data.slice(0,b.loop.start+b.loop.length),b.data=b.data.concat(C.reverse()),b.loop.length=2*b.loop.length,b.length=b.loop.start+b.loop.length}e.goto(u)}}h.setSampleIndex(0),Pe.setInstrument(s,h),v.push({label:s+" "+h._a,data:s})}return be._o(oe,v),r._us=Pe.getInstruments(),Pe.setBPM(a.defaultBPM),Pe._x(a.defaultTempo),A.validate(r),r},validate:function(e){function r(e,t){var n=!0;if(e.points&&e.points[0])if(0===e.points[0][0])for(var a=0,r=1;r<e.count;r++){var i=e.points[r];i&&a<i[0]?a=i[0]:n=!1}else n=!1;else n=!1;return n?e:"volume"===t?{raw:[],enabled:!1,points:[[0,48],[10,64],[20,40],[30,18],[40,28],[50,18]],count:6}:{raw:[],enabled:!1,points:[[0,32],[20,40],[40,24],[60,32],[80,32]],count:5}}e._us.forEach(function(e){e._c=r(e._c,"volume"),e._d=r(e._d,"panning");for(var t=e.samples.length-1,n=0,a=e._z.length;n<a;n++)e._z[n]=Math.min(e._z[n],t)})}};return A},Fe=function(){function o(e,t,n){var a=Pe.getProperties().tickTime,r=e.sustain?e._H+1:e.count;e._w=Math.min(e._w,e.count-1),e._J=Math.min(e._J,e.count-1);var i=e.loop&&e._w<e._J;e.sustain&&e._H<=e._w&&(i=!1),i&&(r=e._J+1);var o=0;if(t.gain)var s=t.gain,u=0,_=64;else s=t.pan,_=u=32;s.setValueAtTime((e.points[0][1]-u)/_,n);for(var l=1;l<r;l++){var c=e.points[l];s.linearRampToValueAtTime((c[1]-u)/_,n+(o=c[0]*a))}return!!i&&p.scheduleEnvelopeLoop(t,n,2,o)}var p={type:"sample",_a:"",_q:0,sampleIndex:-1,fadeout:128,data:[]};return p.samples=[D()],p.sample=p.samples[0],p._c={raw:[],enabled:!1,points:[[0,48],[10,64],[20,40],[30,18],[40,28],[50,18]],count:6},p._d={raw:[],enabled:!1,points:[[0,32],[20,40],[40,24],[60,32],[80,32]],count:5},p._p={},p._z=[],p.play=function(e,t,n,a,r,i){return Pe._j()&&(t=p._O(e)),ye.playSample(p._q,t,n,a,r,i,e)},p.noteOn=function(e){var t,n,a={};if(p._c.enabled){t=ye.context.createGain();var r=p._c,i=o(r,t,e);i&&(a.volume=e+i)}return p._d.enabled&&ye.usePanning&&(n=ye.context.createStereoPanner(),(i=o(r=p._d,n,e))&&(a.panning=e+i)),p._p.rate&&p._p.depth&&(a.ticks=0,a._p=e,a._pFunction=p._D()),{volume:t,panning:n,scheduled:a}},p.noteOff=function(e,t){function n(){t.volume.gain.cancelScheduledValues(e),t._X.gain.cancelScheduledValues(e),t._c&&t._c.gain.cancelScheduledValues(e),t._d&&t._d.pan.cancelScheduledValues(e),t.scheduled=void 0}if(t&&t.volume){if(Pe._j()){var a=Pe.getProperties().tickTime;if(p._c.enabled){if(p._c.sustain&&t._c){n();var r=0,i=p._c.points[p._c._H];i&&(r=i[0]*a);for(var o=p._c._H;o<p._c.count;o++){var s=p._c.points[o];s&&t._c.gain.linearRampToValueAtTime(s[1]/64,e+s[0]*a-r)}}if(p.fadeout)t._X.gain.linearRampToValueAtTime(0,e+65536/p.fadeout*a/2)}else n(),t._X.gain.linearRampToValueAtTime(0,e+.1);if(p._d.enabled&&ye.usePanning&&t._d)for(r=0,(i=p._d.points[p._d._H])&&(r=i[0]*a),o=p._d._H;o<p._d.count;o++)(s=p._d.points[o])&&t._d.pan.linearRampToValueAtTime((s[1]-32)/32,e+s[0]*a-r);return 100}if(n(),!t.isKey||!t.volume)return 0;t.volume.gain.linearRampToValueAtTime(0,e+.5)}},p.scheduleEnvelopeLoop=function(e,t,n,a){a=a||0;var r=Pe.getProperties().tickTime;if(e.gain)var i=p._c,o=e.gain,s=0,u=64;else i=p._d,o=e.pan,u=s=32;var _=i.points[i._w],l=_[0];if(i.loop&&i._w<i._J)for(;a<n;)for(var c=a,f=i._w;f<=i._J;f++)o.linearRampToValueAtTime(((_=i.points[f])[1]-s)/u,t+(a=c+(_[0]-l)*r));return a},p.scheduleAutoVibrato=function(e,t){var n=0;e.scheduled.ticks=e.scheduled.ticks||0;var a,r,i,o,s=Pe.getProperties().tickTime,u=-p._p.rate/40,_=p._p.depth/8;for(Pe._s&&(_*=4),e.source&&(a=e._U,r=e.scheduled._pFunction||ye._r.sine,i=e.scheduled._p||ye.context.currentTime,o=0);n<t;){if(n+=s,a){var l=1;p._p.sweep&&e.scheduled.ticks<p._p.sweep&&(l=1-(p._p.sweep-e.scheduled.ticks)/p._p.sweep);var c=r(a,e.scheduled.ticks,u,_*l);Pe.$d(e,c,i+o*s),o++}e.scheduled.ticks++}return n},p._D=function(){switch(p._p.type){case 1:return ye._r.square;case 2:return ye._r.saw;case 3:return ye._r.sawInverse}return ye._r.sine},p.resetVolume=function(e,t){if(t._X&&(t._X.gain.cancelScheduledValues(e),t._X.gain.setValueAtTime(1,e)),t._c){t._c.gain.cancelScheduledValues(e);var n=Pe.getProperties().tickTime,a=p._c.sustain?p._c._H+1:p._c.count;t._c.gain.setValueAtTime(p._c.points[0][1]/64,e);for(var r=1;r<a;r++){var i=p._c.points[r];t._c.gain.linearRampToValueAtTime(i[1]/64,e+i[0]*n)}}},p._G=function(){return Pe._j()?p.sample.finetuneX:p.sample.finetune},p.setFineTune=function(e){Pe._j()?(p.sample.finetuneX=e,p.sample.finetune=e>>4):(7<e&&(e-=16),p.sample.finetune=e,p.sample.finetuneX=e<<4)},p._O=function(e,t){var n=0;return Pe._s?(n=7680-64*(e-1),t&&(n-=p._G()/2)):(n=Ce[e]._b,t&&p._G()&&(n=ye._E(e,p._G()))),n},p.setSampleForNoteIndex=function(e){var t=p._z[e-1];t!==p.sampleIndex&&"number"==typeof t&&p.setSampleIndex(t)},p.setSampleIndex=function(e){p.sampleIndex!==e&&(p.sample=p.samples[e],p.sampleIndex=e,be._o(n,p._q))},p.hasSamples=function(){for(var e=0,t=p.samples.length;e<t;e++)if(p.samples[e].length)return!0},p.hasVibrato=function(){return p._p.rate&&p._p.depth},p},D=function(){var r={data:[],length:0,_a:"",bits:8,volume:64,finetune:0,finetuneX:0,panning:0,relativeNote:0,loop:{enabled:!1,start:0,length:0,type:0},check:function(){for(var e=0,t=0,n=0,a=r.data.length;n<a;n++)e=Math.min(e,r.data[n]),t=Math.max(t,r.data[n]);return{min:e,max:t}}};return r},Ve=function(){var n={_b:0,index:0,effect:0,_u:0,_i:0,_T:0,setPeriod:function(e){n._b=e,n.index=Ae[e]||0},setIndex:function(e){var t=Ce[n.index=e];t?(n._b=t._k||t._b,1===n._b&&(n._b=0)):n._b=0},clear:function(){n._u=0,n._b=0,n.effect=0,n._i=0,n.index=0,n._T=0},duplicate:function(){return{_u:n._u,_b:n._b,effect:n.effect,_i:n._i,_T:n._T,note:n.index}},populate:function(e){n._u=e._u||0,n._b=e._b||0,n.effect=e.effect||0,n._i=e._i||0,n._T=e._T||0,n.index=e.note||e.index||0}};return n};return{init:Pe.init,load:Pe.load,playSong:Pe.playSong,stop:Pe.stop,togglePlay:Pe.togglePlay,isPlaying:Pe.isPlaying,$b:Pe.$b,getSong:Pe.getSong,getInstruments:Pe.getInstruments,getStateAtTime:Pe.getStateAtTime,getTimeStates:Pe.getTimeStates,setCurrentSongPosition:Pe.setCurrentSongPosition,setBPM:Pe.setBPM,getBPM:Pe.getBPM,_x:Pe._x,getAmigaSpeed:Pe.getAmigaSpeed,setMaster:Pe.setMaster,isMaster:Pe.isMaster,audio:ye}};"undefined"!=typeof HostBridge&&HostBridge.customConfig||(BassoonTracker=BassoonTracker());